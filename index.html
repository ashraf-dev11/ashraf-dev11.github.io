<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙÙŠØªÙ†Ø³ AI - Ø®Ø·Ø· Ù„ÙŠØ§Ù‚Ø© Ø°ÙƒÙŠØ©</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Cairo', sans-serif; background: #f8fafc; }
        .gradient-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-secondary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .gradient-success { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .fade-in { animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-up { animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .chat-bubble { border-radius: 18px; padding: 12px 16px; margin: 8px 0; max-width: 80%; }
        .user-bubble { background: #3b82f6; color: white; margin-left: auto; }
        .ai-bubble { background: #10b981; color: white; margin-right: auto; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="min-h-screen">

<!-- Header -->
<header class="bg-white shadow-sm">
    <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="gradient-primary w-12 h-12 rounded-xl flex items-center justify-center">
                <i class="fas fa-dumbbell text-white text-xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-gray-800">ÙÙŠØªÙ†Ø³ Ø§Ù„Ø°ÙƒÙŠ</h1>
                <p class="text-sm text-gray-600">Ø¨Ø¯Ø¹Ù… DeepSeek AI</p>
            </div>
        </div>
        <div id="authSection" class="flex items-center gap-3">
            <div id="authButtons"></div>
        </div>
    </nav>
</header>

<!-- Main Content -->
<main class="container mx-auto px-4 py-8">
    
    <!-- Auth Page -->
    <div id="authPage" class="max-w-md mx-auto fade-in">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold mb-6 text-center">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ÙÙŠØªÙ†Ø³ Ø§Ù„Ø°ÙƒÙŠ</h2>
            <p class="text-gray-600 mb-8 text-center">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ø§Ù‹ Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block mb-2 font-medium">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="authEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="example@email.com">
                </div>
                
                <div>
                    <label class="block mb-2 font-medium">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="authPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="********">
                </div>
                
                <div class="flex gap-3">
                    <button onclick="signInUser()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg font-bold transition">
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                    <button onclick="signUpUser()" class="flex-1 bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg font-bold transition">
                        Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
                
                <div class="text-center">
                    <button onclick="resetPassword()" class="text-blue-600 hover:text-blue-800 text-sm">
                        Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ
                    </button>
                </div>
            </div>
        </div>
        
        <div class="mt-8 grid grid-cols-3 gap-4">
            <div class="bg-white p-4 rounded-xl text-center card-hover">
                <div class="text-blue-500 text-2xl mb-2"><i class="fas fa-brain"></i></div>
                <p class="text-sm">Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
            </div>
            <div class="bg-white p-4 rounded-xl text-center card-hover">
                <div class="text-green-500 text-2xl mb-2"><i class="fas fa-calendar-alt"></i></div>
                <p class="text-sm">Ø®Ø·Ø· Ø´Ù‡Ø±ÙŠØ©</p>
            </div>
            <div class="bg-white p-4 rounded-xl text-center card-hover">
                <div class="text-purple-500 text-2xl mb-2"><i class="fas fa-chart-line"></i></div>
                <p class="text-sm">Ù…ØªØ§Ø¨Ø¹Ø© Ø°ÙƒÙŠØ©</p>
            </div>
        </div>
    </div>

    <!-- Profile Setup -->
    <div id="profilePage" class="hidden max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="gradient-primary p-6">
                <h2 class="text-2xl font-bold text-white text-center">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
                <p class="text-white/80 text-center mt-2">Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ù…Ø®ØµØµØ© 100% Ù„Ùƒ</p>
            </div>
            
            <div class="p-6 space-y-6">
                <div>
                    <label class="block mb-2 font-medium">Ø§Ø³Ù…Ùƒ</label>
                    <input type="text" id="userName" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block mb-2 font-medium">Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)</label>
                        <input type="number" id="userWeight" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="75">
                    </div>
                    <div>
                        <label class="block mb-2 font-medium">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
                        <input type="number" id="userHeight" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="175">
                    </div>
                </div>
                
                <div>
                    <label class="block mb-2 font-medium">Ø§Ù„Ø¹Ù…Ø±</label>
                    <input type="number" id="userAge" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="25">
                </div>
                
                <div>
                    <label class="block mb-2 font-medium">Ù…Ø§ Ù‡Ùˆ Ù‡Ø¯ÙÙƒØŸ</label>
                    <select id="userGoal" class="w-full p-3 border border-gray-300 rounded-lg">
                        <option value="weight_loss">ğŸ”¥ Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙˆØ²Ù† ÙˆØ­Ø±Ù‚ Ø§Ù„Ø¯Ù‡ÙˆÙ†</option>
                        <option value="muscle_gain">ğŸ’ª Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª ÙˆØ§Ù„ØªØ¶Ø®ÙŠÙ…</option>
                        <option value="fitness">ğŸƒ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</option>
                        <option value="maintenance">âš–ï¸ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù†</option>
                    </select>
                </div>
                
                <div>
                    <label class="block mb-2 font-medium">Ù…Ø³ØªÙˆÙ‰ Ù†Ø´Ø§Ø·Ùƒ</label>
                    <select id="userActivity" class="w-full p-3 border border-gray-300 rounded-lg">
                        <option value="sedentary">ğŸ’º Ù‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© (Ø¹Ù…Ù„ Ù…ÙƒØªØ¨ÙŠ)</option>
                        <option value="light">ğŸš¶ Ø®ÙÙŠÙ (ØªÙ…Ø§Ø±ÙŠÙ† 1-3 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
                        <option value="moderate" selected>ğŸ’ª Ù…ØªÙˆØ³Ø· (ØªÙ…Ø§Ø±ÙŠÙ† 3-5 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
                        <option value="active">ğŸ”¥ Ù†Ø´ÙŠØ· (ØªÙ…Ø§Ø±ÙŠÙ† 6-7 Ø£ÙŠØ§Ù…/Ø£Ø³Ø¨ÙˆØ¹)</option>
                        <option value="athlete">ğŸ† Ø±ÙŠØ§Ø¶ÙŠ (ØªÙ…Ø§Ø±ÙŠÙ† Ù…ÙƒØ«ÙØ© ÙŠÙˆÙ…ÙŠØ§Ù‹)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block mb-2 font-medium">Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ…Ø±ÙŠÙ†</label>
                    <div class="grid grid-cols-3 gap-3">
                        <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer">
                            <input type="radio" name="workoutPlace" value="gym" class="mr-2" checked>
                            <span>ğŸ‹ï¸ Ù†Ø§Ø¯ÙŠ Ø±ÙŠØ§Ø¶ÙŠ</span>
                        </label>
                        <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer">
                            <input type="radio" name="workoutPlace" value="home" class="mr-2">
                            <span>ğŸ  Ø§Ù„Ù…Ù†Ø²Ù„</span>
                        </label>
                        <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer">
                            <input type="radio" name="workoutPlace" value="both" class="mr-2">
                            <span>ğŸ”€ Ø§Ù„Ø§Ø«Ù†Ø§Ù† Ù…Ø¹Ø§Ù‹</span>
                        </label>
                    </div>
                </div>
                
                <div class="pt-4">
                    <button onclick="generateAIplan()" class="w-full gradient-success text-white p-4 rounded-xl font-bold text-lg pulse">
                        <i class="fas fa-robot mr-2"></i> Ø£Ù†Ø´Ø¦ Ø®Ø·ØªÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Processing -->
    <div id="loadingPage" class="hidden max-w-md mx-auto text-center">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="relative mb-6">
                <div class="w-24 h-24 mx-auto border-4 border-blue-200 rounded-full"></div>
                <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-24 h-24 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-3xl">ğŸ¤–</div>
            </div>
            
            <h3 class="text-xl font-bold mb-4">DeepSeek AI ÙŠØµÙ…Ù… Ø®Ø·ØªÙƒ</h3>
            <p class="text-gray-600 mb-6">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø´Ù‡Ø±ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø©</p>
            
            <div class="space-y-3 text-sm text-gray-500">
                <div class="flex items-center justify-between">
                    <span>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                    <i class="fas fa-check text-green-500" id="step1"></i>
                </div>
                <div class="flex items-center justify-between">
                    <span>ØªØµÙ…ÙŠÙ… Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</span>
                    <i class="fas fa-check text-green-500 hidden" id="step2"></i>
                </div>
                <div class="flex items-center justify-between">
                    <span>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ°Ø§Ø¦ÙŠ</span>
                    <i class="fas fa-check text-green-500 hidden" id="step3"></i>
                </div>
                <div class="flex items-center justify-between">
                    <span>Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ</span>
                    <i class="fas fa-check text-green-500 hidden" id="step4"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chat & Plan -->
    <div id="aiChatPage" class="hidden max-w-4xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <!-- Chat Header -->
            <div class="gradient-primary p-6">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center">
                            <i class="fas fa-robot text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-white">DeepSeek AI Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ</h2>
                            <p class="text-white/80 text-sm">Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ ÙÙŠ Ø®Ø·ØªÙƒ</p>
                        </div>
                    </div>
                    <button onclick="showPage('profile')" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-edit mr-2"></i> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                </div>
            </div>
            
            <!-- Chat Container -->
            <div class="flex h-[500px]">
                <!-- Chat Messages -->
                <div class="flex-1 p-6 overflow-y-auto">
                    <div id="chatMessages">
                        <!-- Messages will appear here -->
                    </div>
                    
                    <!-- AI Plan Display -->
                    <div id="aiPlan" class="mt-6 hidden">
                        <!-- AI generated plan will appear here -->
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="w-64 border-r p-6 space-y-4">
                    <h3 class="font-bold mb-4">ğŸ”„ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
                    <button onclick="askAI('Ù…Ø§ Ù‡ÙŠ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ØŸ')" class="w-full text-right p-3 bg-blue-50 hover:bg-blue-100 rounded-lg">
                        <i class="fas fa-dumbbell ml-2"></i> ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…
                    </button>
                    <button onclick="askAI('Ù…Ø§ Ù‡ÙŠ ÙˆØ¬Ø¨Ø© Ø§Ù„ØºØ¯Ø§Ø¡ØŸ')" class="w-full text-right p-3 bg-green-50 hover:bg-green-100 rounded-lg">
                        <i class="fas fa-utensils ml-2"></i> ÙˆØ¬Ø¨Ø© Ø§Ù„ØºØ¯Ø§Ø¡
                    </button>
                    <button onclick="askAI('Ø£Ø¹Ø·Ù†ÙŠ Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø¨Ø±ÙˆØªÙŠÙ†')" class="w-full text-right p-3 bg-purple-50 hover:bg-purple-100 rounded-lg">
                        <i class="fas fa-lightbulb ml-2"></i> Ù†ØµØ§Ø¦Ø­ ØºØ°Ø§Ø¦ÙŠØ©
                    </button>
                    <button onclick="askAI('ÙƒÙŠÙ Ø£ØªØ§Ø¨Ø¹ ØªÙ‚Ø¯Ù…ÙŠØŸ')" class="w-full text-right p-3 bg-yellow-50 hover:bg-yellow-100 rounded-lg">
                        <i class="fas fa-chart-line ml-2"></i> Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù…
                    </button>
                    <button onclick="generateFullPlan()" class="w-full gradient-success text-white p-3 rounded-lg font-bold mt-4">
                        <i class="fas fa-redo mr-2"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©
                    </button>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="border-t p-4">
                <div class="flex gap-3">
                    <input type="text" id="chatInput" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Ø§Ø³Ø£Ù„ AI Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ ÙÙŠ Ø®Ø·ØªÙƒ...">
                    <button onclick="sendMessage()" class="gradient-primary text-white px-6 py-3 rounded-lg font-bold">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="flex gap-2 mt-3 overflow-x-auto">
                    <button onclick="askAI('Ø£Ø¹Ø·Ù†ÙŠ Ø®Ø·Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©')" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm whitespace-nowrap">Ø®Ø·Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</button>
                    <button onclick="askAI('Ø£Ø¹Ø·Ù†ÙŠ Ù†Ø¸Ø§Ù… ØºØ°Ø§Ø¦ÙŠ ÙŠÙˆÙ…ÙŠ')" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm whitespace-nowrap">Ù†Ø¸Ø§Ù… ØºØ°Ø§Ø¦ÙŠ</button>
                    <button onclick="askAI('ÙƒÙŠÙ Ø£Ø²ÙŠØ¯ Ù…Ù† ÙˆØ²Ù†ÙŠØŸ')" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm whitespace-nowrap">Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆØ²Ù†</button>
                    <button onclick="askAI('ÙƒÙŠÙ Ø£Ù†Ø­Ù Ø¨Ø³Ø±Ø¹Ø©ØŸ')" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm whitespace-nowrap">Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙˆØ²Ù†</button>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Firebase & AI Integration -->
<script>
// ========== FIREBASE CONFIG ==========
const firebaseConfig = {
    apiKey: "AIzaSyCrOyz_5uc63XPhCD_S7WwtAx6CfgcxbTk",
    authDomain: "fitness-app-users-c71e4.firebaseapp.com",
    projectId: "fitness-app-users-c71e4",
    storageBucket: "fitness-app-users-c71e4.firebasestorage.app",
    messagingSenderId: "631538722348",
    appId: "1:631538722348:web:0bdb2bb79d351c072a1389"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ========== DEEPSEEK AI CONFIG ==========
const DEEPSEEK_API_KEY = "sk-89757c271e8347c0a74bd3ea46fb52a3";
const DEEPSEEK_API_URL = "https://api.deepseek.com/v1/chat/completions";

// ========== GLOBAL VARIABLES ==========
let currentUser = null;
let userProfile = null;
let aiPlanData = null;

// ========== AUTHENTICATION SYSTEM ==========
// Monitor auth state
auth.onAuthStateChanged((user) => {
    currentUser = user;
    updateAuthUI();
    
    if (user) {
        // User is signed in
        showPage('profile');
        loadUserProfile();
    } else {
        // No user is signed in
        showPage('auth');
    }
});

// Update auth UI
function updateAuthUI() {
    const authButtons = document.getElementById('authButtons');
    
    if (currentUser) {
        authButtons.innerHTML = `
            <div class="flex items-center gap-3">
                <div class="text-right">
                    <p class="font-bold text-sm">${currentUser.email}</p>
                    <p class="text-xs text-gray-600">Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</p>
                </div>
                <button onclick="signOutUser()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm">
                    Ø®Ø±ÙˆØ¬
                </button>
            </div>
        `;
    } else {
        authButtons.innerHTML = '';
    }
}

// Sign in user
async function signInUser() {
    const email = document.getElementById('authEmail').value;
    const password = document.getElementById('authPassword').value;
    
    if (!email || !password) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
        return;
    }
    
    try {
        await auth.signInWithEmailAndPassword(email, password);
    } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message);
    }
}

// Sign up user
async function signUpUser() {
    const email = document.getElementById('authEmail').value;
    const password = document.getElementById('authPassword').value;
    
    if (!email || !password) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
        return;
    }
    
    if (password.length < 6) {
        alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
    }
    
    try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        // Save basic user info to Firestore
        await db.collection('users').doc(userCredential.user.uid).set({
            email: email,
            createdAt: new Date(),
            lastLogin: new Date()
        });
    } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: ' + error.message);
    }
}

// Sign out user
async function signOutUser() {
    try {
        await auth.signOut();
    } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ' + error.message);
    }
}

// Reset password
async function resetPassword() {
    const email = document.getElementById('authEmail').value;
    
    if (!email) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
        return;
    }
    
    try {
        await auth.sendPasswordResetEmail(email);
        alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
    } catch (error) {
        alert('Ø®Ø·Ø£: ' + error.message);
    }
}

// ========== PAGE MANAGEMENT ==========
function showPage(pageName) {
    const pages = ['authPage', 'profilePage', 'loadingPage', 'aiChatPage'];
    pages.forEach(page => {
        document.getElementById(page).classList.add('hidden');
    });
    document.getElementById(pageName).classList.remove('hidden');
}

// ========== USER PROFILE ==========
async function loadUserProfile() {
    if (!currentUser) return;
    
    try {
        const doc = await db.collection('users').doc(currentUser.uid).get();
        if (doc.exists) {
            userProfile = doc.data();
            // Fill form if data exists
            if (userProfile.name) document.getElementById('userName').value = userProfile.name;
            if (userProfile.weight) document.getElementById('userWeight').value = userProfile.weight;
            if (userProfile.height) document.getElementById('userHeight').value = userProfile.height;
            if (userProfile.age) document.getElementById('userAge').value = userProfile.age;
            if (userProfile.goal) document.getElementById('userGoal').value = userProfile.goal;
            if (userProfile.activity) document.getElementById('userActivity').value = userProfile.activity;
        }
    } catch (error) {
        console.error('Error loading profile:', error);
    }
}

async function saveUserProfile() {
    if (!currentUser) return;
    
    userProfile = {
        name: document.getElementById('userName').value,
        weight: document.getElementById('userWeight').value,
        height: document.getElementById('userHeight').value,
        age: document.getElementById('userAge').value,
        goal: document.getElementById('userGoal').value,
        activity: document.getElementById('userActivity').value,
        workoutPlace: document.querySelector('input[name="workoutPlace"]:checked').value,
        lastUpdated: new Date()
    };
    
    try {
        await db.collection('users').doc(currentUser.uid).set(userProfile, { merge: true });
        return true;
    } catch (error) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
        return false;
    }
}

// ========== DEEPSEEK AI INTEGRATION ==========
async function generateAIplan() {
    // Save profile first
    const saved = await saveUserProfile();
    if (!saved) return;
    
    // Show loading page
    showPage('loading');
    
    // Simulate steps
    const steps = ['step1', 'step2', 'step3', 'step4'];
    steps.forEach((stepId, index) => {
        setTimeout(() => {
            document.getElementById(stepId).classList.remove('hidden');
        }, (index + 1) * 1000);
    });
    
    // Create AI prompt
    const prompt = createAIPrompt(userProfile);
    
    // Call DeepSeek API
    try {
        const response = await callDeepSeekAPI(prompt);
        aiPlanData = response;
        
        // Save plan to Firestore
        await savePlanToFirestore(response);
        
        // Show chat page
        setTimeout(() => {
            showPage('aiChatPage');
            displayAIPlan(response);
            addAIMessage("Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø°ÙƒÙŠ DeepSeek AI. Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ù„ÙŠØ§Ù‚Ø© Ù…Ø®ØµØµØ© Ù„Ùƒ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„. ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø¤Ø§Ù„ÙŠ Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ ÙÙŠ Ø®Ø·ØªÙƒ!");
        }, 5000);
        
    } catch (error) {
        console.error('AI Error:', error);
        // Fallback to local plan
        aiPlanData = generateLocalPlan(userProfile);
        showPage('aiChatPage');
        addAIMessage("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. Ù„ÙƒÙ†ÙŠ Ø£Ù†Ø´Ø£Øª Ù„Ùƒ Ø®Ø·Ø© Ù…Ø­Ù„ÙŠØ© Ù…Ø®ØµØµØ©!");
        displayAIPlan(aiPlanData);
    }
}

function createAIPrompt(profile) {
    return `Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ù„ÙŠØ§Ù‚Ø© Ø¨Ø¯Ù†ÙŠØ© ÙˆØªØºØ°ÙŠØ© Ø¹Ø±Ø¨ÙŠ Ù…Ø­ØªØ±Ù. Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ù„ÙŠØ§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ© ÙƒØ§Ù…Ù„Ø© (30 ÙŠÙˆÙ…) Ù„Ù„Ø´Ø®Øµ Ø§Ù„ØªØ§Ù„ÙŠ:

Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©:
- Ø§Ù„Ø§Ø³Ù…: ${profile.name || "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…"}
- Ø§Ù„ÙˆØ²Ù†: ${profile.weight} ÙƒØ¬Ù…
- Ø§Ù„Ø·ÙˆÙ„: ${profile.height} Ø³Ù…
- Ø§Ù„Ø¹Ù…Ø±: ${profile.age} Ø³Ù†Ø©
- Ø§Ù„Ù‡Ø¯Ù: ${getGoalText(profile.goal)}
- Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø·: ${getActivityText(profile.activity)}
- Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ…Ø±ÙŠÙ†: ${getPlaceText(profile.workoutPlace)}

Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
1. Ø®Ø·Ø© ØªÙ…Ø§Ø±ÙŠÙ† Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ù…ÙØµÙ„Ø© (ØªÙ…Ø§Ø±ÙŠÙ†ØŒ Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ ØªÙƒØ±Ø§Ø±Ø§ØªØŒ Ø±Ø§Ø­Ø©)
2. Ù†Ø¸Ø§Ù… ØºØ°Ø§Ø¦ÙŠ ÙŠÙˆÙ…ÙŠ (5-6 ÙˆØ¬Ø¨Ø§Øª) Ù…Ø¹ Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ§Ù„Ø¨Ø±ÙˆØªÙŠÙ†
3. Ù†ØµØ§Ø¦Ø­ ØºØ°Ø§Ø¦ÙŠØ© ÙˆØªÙ…Ø§Ø±ÙŠÙ†
4. Ø¬Ø¯ÙˆÙ„ Ø´Ù‡Ø±ÙŠ Ù„Ù„ØªÙ‚Ø¯Ù…
5. Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©

Ø£Ø±Ø¬Ùˆ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ Ù…Ù†Ø¸Ù… ÙˆØ³Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.`;
}

function getGoalText(goal) {
    const goals = {
        'weight_loss': 'Ø®Ø³Ø§Ø±Ø© Ø§Ù„ÙˆØ²Ù† ÙˆØ­Ø±Ù‚ Ø§Ù„Ø¯Ù‡ÙˆÙ†',
        'muscle_gain': 'Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª ÙˆØ§Ù„ØªØ¶Ø®ÙŠÙ…',
        'fitness': 'ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ø¹Ø§Ù…Ø©',
        'maintenance': 'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù†'
    };
    return goals[goal] || goal;
}

function getActivityText(activity) {
    const activities = {
        'sedentary': 'Ù‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ©',
        'light': 'Ø®ÙÙŠÙ Ø§Ù„Ù†Ø´Ø§Ø·',
        'moderate': 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ø´Ø§Ø·',
        'active': 'Ù†Ø´ÙŠØ· Ø¬Ø¯Ø§Ù‹',
        'athlete': 'Ø±ÙŠØ§Ø¶ÙŠ Ù…Ø­ØªØ±Ù'
    };
    return activities[activity] || activity;
}

function getPlaceText(place) {
    const places = {
        'gym': 'Ù†Ø§Ø¯ÙŠ Ø±ÙŠØ§Ø¶ÙŠ',
        'home': 'Ø§Ù„Ù…Ù†Ø²Ù„',
        'both': 'Ø§Ù„Ù†Ø§Ø¯ÙŠ ÙˆØ§Ù„Ù…Ù†Ø²Ù„'
    };
    return places[place] || place;
}

async function callDeepSeekAPI(prompt) {
    const response = await fetch(DEEPSEEK_API_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
        },
        body: JSON.stringify({
            model: "deepseek-chat",
            messages: [
                {
                    role: "system",
                    content: "Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ù„ÙŠØ§Ù‚Ø© Ø¨Ø¯Ù†ÙŠØ© ÙˆØªØºØ°ÙŠØ© Ø¹Ø±Ø¨ÙŠ Ù…Ø­ØªØ±Ù. Ø£Ø¹Ø· Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ÙØµÙ„Ø© ÙˆÙ…Ù†Ø¸Ù…Ø©."
                },
                {
                    role: "user",
                    content: prompt
                }
            ],
            temperature: 0.7,
            max_tokens: 4000
        })
    });
    
    if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
    }
    
    const data = await response.json();
    return data.choices[0].message.content;
}

function generateLocalPlan(profile) {
    // Fallback plan if AI fails
    return `
# Ø®Ø·Ø© Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ù…Ø®ØµØµØ©
## Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${profile.name}

### ğŸ¯ Ø§Ù„Ù‡Ø¯Ù: ${getGoalText(profile.goal)}

### ğŸ’ª Ø®Ø·Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©:
- Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†: ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ØµØ¯Ø± ÙˆØ§Ù„ØªØ±Ø§ÙŠØ³Ø¨Ø³
- Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡: ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø¸Ù‡Ø± ÙˆØ§Ù„Ø¨Ø§ÙŠØ³Ø¨Ø³
- Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡: ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø£Ø±Ø¬Ù„
- Ø§Ù„Ø®Ù…ÙŠØ³: ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø£ÙƒØªØ§Ù
- Ø§Ù„Ø¬Ù…Ø¹Ø©: ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù‚Ù„Ø¨
- Ø§Ù„Ø³Ø¨Øª: Ø±Ø§Ø­Ø© Ø£Ùˆ ØªÙ…Ø§Ø±ÙŠÙ† Ø®ÙÙŠÙØ©
- Ø§Ù„Ø£Ø­Ø¯: Ø±Ø§Ø­Ø©

### ğŸ½ï¸ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ°Ø§Ø¦ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ:
- Ø§Ù„ÙØ·ÙˆØ±: Ø¨ÙŠØ¶ + Ø´ÙˆÙØ§Ù† + ÙÙˆØ§ÙƒÙ‡
- ÙˆØ¬Ø¨Ø© Ø®ÙÙŠÙØ©: Ù…ÙƒØ³Ø±Ø§Øª
- Ø§Ù„ØºØ¯Ø§Ø¡: Ø¨Ø±ÙˆØªÙŠÙ† + Ø®Ø¶Ø§Ø± + ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª Ù…Ø¹Ù‚Ø¯Ø©
- Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†: Ø¨Ø±ÙˆØªÙŠÙ† Ø´ÙŠÙƒ
- Ø§Ù„Ø¹Ø´Ø§Ø¡: Ø¨Ø±ÙˆØªÙŠÙ† Ø®ÙÙŠÙ + Ø³Ù„Ø·Ø©

### ğŸ“Š Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©: ${calculateCalories(profile)}

### ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ù…Ù‡Ù…Ø©:
1. Ø§Ø´Ø±Ø¨ 3 Ù„ØªØ± Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹
2. Ù†Ù… 7-8 Ø³Ø§Ø¹Ø§Øª Ù„ÙŠÙ„Ø§Ù‹
3. ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† ÙÙŠ ÙƒÙ„ ÙˆØ¬Ø¨Ø©
4. Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ù…
5. Ø³Ø¬Ù„ ØªÙ‚Ø¯Ù…Ùƒ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹
`;
}

function calculateCalories(profile) {
    const weight = profile.weight || 70;
    let calories = weight * 30;
    if (profile.goal === 'weight_loss') calories -= 500;
    if (profile.goal === 'muscle_gain') calories += 500;
    return Math.round(calories);
}

async function savePlanToFirestore(plan) {
    if (!currentUser || !plan) return;
    
    try {
        await db.collection('plans').doc(currentUser.uid).set({
            plan: plan,
            created: new Date(),
            profile: userProfile
        });
    } catch (error) {
        console.error('Error saving plan:', error);
    }
}

// ========== CHAT SYSTEM ==========
function displayAIPlan(plan) {
    const planDiv = document.getElementById('aiPlan');
    planDiv.classList.remove('hidden');
    planDiv.innerHTML = `
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6">
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-robot text-blue-600 mr-2"></i> Ø®Ø·Ø© Ø§Ù„Ù„ÙŠØ§Ù‚Ø© Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©
            </h3>
            <div class="bg-white rounded-lg p-4 max-h-64 overflow-y-auto">
                ${plan.replace(/\n/g, '<br>')}
            </div>
            <div class="mt-4 flex gap-3">
                <button onclick="downloadPlan()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg">
                    <i class="fas fa-download mr-2"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·Ø©
                </button>
                <button onclick="sharePlan()" class="flex-1 bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg">
                    <i class="fas fa-share mr-2"></i> Ù…Ø´Ø§Ø±ÙƒØ©
                </button>
            </div>
        </div>
    `;
}

function addUserMessage(text) {
    const chatDiv = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'chat-bubble user-bubble slide-up';
    messageDiv.innerHTML = `
        <div class="flex items-center mb-1">
            <div class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center mr-2">
                <i class="fas fa-user text-white"></i>
            </div>
            <span class="font-bold">Ø£Ù†Øª</span>
        </div>
        <p>${text}</p>
    `;
    chatDiv.appendChild(messageDiv);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

function addAIMessage(text) {
    const chatDiv = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'chat-bubble ai-bubble slide-up';
    messageDiv.innerHTML = `
        <div class="flex items-center mb-1">
            <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center mr-2">
                <i class="fas fa-robot text-white"></i>
            </div>
            <span class="font-bold">DeepSeek AI</span>
        </div>
        <p>${text}</p>
    `;
    chatDiv.appendChild(messageDiv);
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

async function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    addUserMessage(message);
    input.value = '';
    
    // Show typing indicator
    const chatDiv = document.getElementById('chatMessages');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'chat-bubble ai-bubble';
    typingDiv.id = 'typingIndicator';
    typingDiv.innerHTML = `
        <div class="flex items-center">
            <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center mr-2">
                <i class="fas fa-robot text-white"></i>
            </div>
            <span class="font-bold">DeepSeek AI</span>
        </div>
        <div class="flex gap-1 mt-2">
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
        </div>
    `;
    chatDiv.appendChild(typingDiv);
    chatDiv.scrollTop = chatDiv.scrollHeight;
    
    // Get AI response
    try {
        const response = await askDeepSeek(message);
        document.getElementById('typingIndicator').remove();
        addAIMessage(response);
    } catch (error) {
        document.getElementById('typingIndicator').remove();
        addAIMessage("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
    }
}

async function askAI(question) {
    document.getElementById('chatInput').value = question;
    sendMessage();
}

async function askDeepSeek(question) {
    const context = aiPlanData ? `Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${aiPlanData.substring(0, 1000)}...` : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø·Ø© Ø­Ø§Ù„ÙŠØ©';
    
    const response = await fetch(DEEPSEEK_API_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
        },
        body: JSON.stringify({
            model: "deepseek-chat",
            messages: [
                {
                    role: "system",
                    content: `Ø£Ù†Øª Ù…Ø¯Ø±Ø¨ Ù„ÙŠØ§Ù‚Ø© Ø¨Ø¯Ù†ÙŠØ© Ø¹Ø±Ø¨ÙŠ. ${context} Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø®Ø·ØªÙ‡.`
                },
                {
                    role: "user",
                    content: question
                }
            ],
            temperature: 0.7,
            max_tokens: 1000
        })
    });
    
    const data = await response.json();
    return data.choices[0].message.content;
}

function generateFullPlan() {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©.")) {
        generateAIplan();
    }
}

function downloadPlan() {
    if (!aiPlanData) return;
    
    const element = document.createElement('a');
    const file = new Blob([aiPlanData], {type: 'text/plain'});
    element.href = URL.createObjectURL(file);
    element.download = `Ø®Ø·Ø©-Ø§Ù„Ù„ÙŠØ§Ù‚Ø©-${userProfile.name || 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…'}.txt`;
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
}

function sharePlan() {
    if (!aiPlanData) return;
    
    if (navigator.share) {
        navigator.share({
            title: `Ø®Ø·Ø© Ø§Ù„Ù„ÙŠØ§Ù‚Ø© - ${userProfile.name}`,
            text: aiPlanData.substring(0, 100) + '...',
            url: window.location.href
        });
    } else {
        alert('Ø´Ø§Ø±Ùƒ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹: ' + window.location.href);
    }
}

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', () => {
    // Check auth state
    auth.onAuthStateChanged((user) => {
        if (user) {
            showPage('profile');
        } else {
            showPage('auth');
        }
    });
    
    // Auto focus on email input
    document.getElementById('authEmail')?.focus();
});
</script>
</body>
</html>

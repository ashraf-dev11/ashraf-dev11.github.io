<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุทุจูู ุงูููุงูุฉ ูุงูุชุบุฐูุฉ ุงูุฐูู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .page { display: none; animation: fadeIn 0.5s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .nav-active { background: rgba(255, 255, 255, 0.1); border-radius: 8px; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 font-cairo">
    
    <!-- ุดุงุดุฉ ุงูุชุญููู -->
    <div id="loading-screen" class="fixed inset-0 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center z-50">
        <div class="text-center text-white">
            <div class="text-6xl mb-6">๐ช</div>
            <h1 class="text-4xl font-bold mb-4">ุชุทุจูู ุงูููุงูุฉ ุงูุฐูู</h1>
            <div class="loading mx-auto mb-4" style="width: 40px; height: 40px;"></div>
            <p class="text-xl">ุฌุงุฑู ุชุญุถูุฑ ุงูุชุทุจูู ูู...</p>
            <p class="text-blue-200 mt-2">๐ค ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุนู ูุฌุงูุฒ</p>
        </div>
    </div>

    <!-- ุงูุชุทุจูู ุงูุฑุฆูุณู -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center space-x-3 space-x-reverse mb-4 md:mb-0">
                        <div class="bg-white p-2 rounded-full">
                            <i class="fas fa-dumbbell text-blue-500 text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl md:text-3xl font-bold">ุชุทุจูู ุงูููุงูุฉ ูุงูุชุบุฐูุฉ</h1>
                            <p class="text-blue-100 text-sm" id="ai-status">๐ค ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุนู</p>
                        </div>
                    </div>
                    
                    <nav class="flex space-x-2 space-x-reverse">
                        <button onclick="switchPage('calculator')" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200 nav-active">
                            <i class="fas fa-calculator ml-2"></i>ุงูุญุงุณุจุฉ
                        </button>
                        <button onclick="switchPage('meal-plan')" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200">
                            <i class="fas fa-utensils ml-2"></i>ุฎุทุฉ ุงูุชุบุฐูุฉ
                        </button>
                        <button onclick="switchPage('workout')" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200">
                            <i class="fas fa-dumbbell ml-2"></i>ุงูุชูุงุฑูู
                        </button>
                    </nav>
                </div>
            </div>
        </header>

        <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
        <main class="container mx-auto px-4 py-8">
            <!-- ุตูุญุฉ ุงูุญุงุณุจุฉ -->
            <section id="calculator-page" class="page active">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-dark mb-4">ุงุญุณุจ ุงุญุชูุงุฌุงุชู ุงูููููุฉ</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">ุฃุฏุฎู ุจูุงูุงุชู ูุชุญุตู ุนูู ุฎุทุท ูุฎุตุตุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- ูููุฐุฌ ุงูุฅุฏุฎุงู -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="flex items-center mb-6">
                            <div class="bg-blue-500 p-3 rounded-full ml-4">
                                <i class="fas fa-user text-white text-xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-dark">ุจูุงูุงุชู ุงูุดุฎุตูุฉ</h3>
                        </div>
                        
                        <form id="calculatorForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงููุฒู (ูุฌู)</label>
                                    <input type="number" id="weight" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20" placeholder="ูุซุงู: 75" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงูุทูู (ุณู)</label>
                                    <input type="number" id="height" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20" placeholder="ูุซุงู: 175" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงูุนูุฑ (ุณูุฉ)</label>
                                    <input type="number" id="age" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20" placeholder="ูุซุงู: 25" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงูุฌูุณ</label>
                                    <div class="flex space-x-4 space-x-reverse">
                                        <label class="flex items-center space-x-2 space-x-reverse cursor-pointer">
                                            <input type="radio" name="gender" value="male" checked class="text-blue-500">
                                            <span>ุฐูุฑ</span>
                                        </label>
                                        <label class="flex items-center space-x-2 space-x-reverse cursor-pointer">
                                            <input type="radio" name="gender" value="female" class="text-blue-500">
                                            <span>ุฃูุซู</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุงููุฏู ุงูุฑุฆูุณู</label>
                                    <select id="goal" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
                                        <option value="cutting">ุชูุดูู ูุญุฑู ุงูุฏููู</option>
                                        <option value="bulking">ุชุถุฎูู ูุจูุงุก ุงูุนุถูุงุช</option>
                                        <option value="maintain" selected>ุงููุญุงูุธุฉ ูุงูุชุญุณูู</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ุฃูุงู ุงูุชูุฑูู ุฃุณุจูุนูุงู</label>
                                    <select id="workoutDays" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
                                        <option value="3">3 ุฃูุงู</option>
                                        <option value="4" selected>4 ุฃูุงู</option>
                                        <option value="5">5 ุฃูุงู</option>
                                        <option value="6">6 ุฃูุงู</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ููุน ุงูุฎุทุฉ</label>
                                    <select id="planType" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
                                        <option value="normal">ุฃูุงู ุนุงุฏูุฉ</option>
                                        <option value="ramadan">ุดูุฑ ุฑูุถุงู</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-gray-700 font-medium mb-2">ูุธุงู ุงูุชูุงุฑูู</label>
                                    <select id="workoutSystem" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
                                        <option value="bro_split">ุจุฑู ุณุจูุช (ุนุถูุฉ ูุงุญุฏุฉ ูู ุงูููู)</option>
                                        <option value="push_pull_legs">ุจูุด ุจูู ููุฌ (ุฏูุน-ุณุญุจ-ุฃุฑุฌู)</option>
                                        <option value="arnold_split">ุฃุฑูููุฏ ุณุจูุช</option>
                                        <option value="full_body">ุชูุงุฑูู ูุงููุฉ ุงูุฌุณู</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full gradient-bg hover:opacity-90 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-[1.02] shadow-lg">
                                <i class="fas fa-robot ml-2"></i> ุงุญุณุจ ุจุงุณุชุฎุฏุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
                            </button>
                        </form>
                    </div>
                    
                    <!-- ุนุฑุถ ุงููุชุงุฆุฌ -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="flex items-center mb-6">
                            <div class="bg-green-500 p-3 rounded-full ml-4">
                                <i class="fas fa-chart-line text-white text-xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-dark">ูุชุงุฆุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู</h3>
                        </div>
                        
                        <div id="results" class="space-y-6">
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">๐ค</div>
                                <p class="text-gray-500 text-lg">ุฃุฏุฎู ุจูุงูุงุชู ูุงุถุบุท ุนูู "ุงุญุณุจ ุจุงุณุชุฎุฏุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู"</p>
                                <p class="text-gray-400 mt-2">ุณูููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุจุญุณุงุจ ุงุญุชูุงุฌุงุชู ูุนุฑุถ ุงููุชุงุฆุฌ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ุตูุญุฉ ุฎุทุฉ ุงูุชุบุฐูุฉ -->
            <section id="meal-plan-page" class="page">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-dark mb-4">ุฎุทุฉ ุงูุชุบุฐูุฉ ุงูุดูุฑูุฉ</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">ุฎุทุฉ ูุฌุจุงุช ูุชููุนุฉ ููุฏุฉ 30 ููู ุจุฏูู ุชูุฑุงุฑ (ูููุฏุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู)</p>
                </div>
                
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div class="p-8 border-b border-gray-100">
                        <div class="flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h3 class="text-2xl font-bold text-dark mb-2">ุฌุฏูู ุงููุฌุจุงุช ุงูุฃุณุจูุนู</h3>
                                <div class="flex flex-wrap items-center gap-2 mt-2">
                                    <span class="px-4 py-1 bg-blue-100 text-blue-600 rounded-full text-sm font-medium" id="planTypeDisplay">-</span>
                                    <span class="px-4 py-1 bg-green-100 text-green-600 rounded-full text-sm font-medium" id="goalDisplay">-</span>
                                    <span class="px-4 py-1 bg-purple-100 text-purple-600 rounded-full text-sm font-medium">๐ค ุงูุฐูุงุก ุงูุงุตุทูุงุนู</span>
                                </div>
                            </div>
                            <div class="flex space-x-4 space-x-reverse mt-6 md:mt-0">
                                <button id="prevWeek" class="px-5 py-2 border-2 border-gray-200 rounded-xl hover:bg-gray-50 transition-colors duration-200">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                                <span id="weekDisplay" class="px-6 py-2 font-bold text-lg text-dark">ุงูุฃุณุจูุน 1</span>
                                <button id="nextWeek" class="px-5 py-2 border-2 border-gray-200 rounded-xl hover:bg-gray-50 transition-colors duration-200">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-8" id="mealPlanContent">
                        <div class="text-center py-16">
                            <div class="text-6xl mb-4">๐ฝ๏ธ</div>
                            <p class="text-gray-500 text-lg">ูุฌุจ ุฅุฏุฎุงู ุจูุงูุงุชู ูู ุตูุญุฉ ุงูุญุงุณุจุฉ ุฃููุงู</p>
                            <button onclick="switchPage('calculator')" class="mt-6 gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200 transform hover:scale-[1.02] shadow-lg">
                                ุงูุฐูุงุจ ููุญุงุณุจุฉ
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ุตูุญุฉ ุงูุชูุงุฑูู -->
            <section id="workout-page" class="page">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-dark mb-4">ุจุฑูุงูุฌ ุงูุชูุงุฑูู</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">ุจุฑูุงูุฌ ุชูุงุฑูู ูุฎุตุต ุจูุงุกู ุนูู ุงุฎุชูุงุฑุงุชู (ูููุฏ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู)</p>
                </div>
                
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="mb-8 p-6 bg-gradient-to-r from-blue-100 to-green-100 rounded-2xl">
                        <div class="flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h3 class="text-xl font-bold text-dark mb-2" id="workoutSystemDisplay">ูุธุงู ุงูุชูุงุฑูู</h3>
                                <div class="flex flex-wrap gap-2">
                                    <span class="px-3 py-1 bg-blue-500 text-white rounded-full text-sm font-medium">
                                        <i class="fas fa-calendar ml-1"></i> <span id="workoutDaysDisplay">-</span> ุฃูุงู ุฃุณุจูุนูุงู
                                    </span>
                                    <span class="px-3 py-1 bg-green-500 text-white rounded-full text-sm font-medium">
                                        <i class="fas fa-bullseye ml-1"></i> <span id="workoutGoalDisplay">-</span>
                                    </span>
                                </div>
                            </div>
                            <div class="mt-4 md:mt-0">
                                <button onclick="generateWorkoutPlanWithAI()" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg">
                                    <i class="fas fa-sync-alt ml-2"></i>
                                    ุชูููุฏ ุฌุฏูุฏ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="workoutPlanContent">
                        <div class="text-center py-16">
                            <div class="text-6xl mb-4">๐ช</div>
                            <p class="text-gray-500 text-lg">ุจุฑูุงูุฌ ุงูุชูุงุฑูู ุณูุธูุฑ ููุง ุจุนุฏ ุฅุฏุฎุงู ุจูุงูุงุชู</p>
                            <p class="text-gray-400 mt-2">ูุชู ุชูููุฏ ุงูุจุฑูุงูุฌ ุชููุงุฆูุงู ุจูุงุกู ุนูู ุงุฎุชูุงุฑุงุชู ูู ุตูุญุฉ ุงูุญุงุณุจุฉ</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white py-12 mt-16">
            <div class="container mx-auto px-4 text-center">
                <div class="flex flex-col items-center mb-8">
                    <div class="bg-white p-3 rounded-full mb-4">
                        <i class="fas fa-dumbbell text-blue-500 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">ุชุทุจูู ุงูููุงูุฉ ูุงูุชุบุฐูุฉ</h3>
                    <p class="text-gray-400 max-w-md">ุฎุทุท ุชุบุฐูุฉ ูุชูุงุฑูู ูุฎุตุตุฉ ูู ุจุงุณุชุฎุฏุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู</p>
                </div>
                
                <div class="border-t border-gray-700 pt-8 text-gray-400">
                    <p>ยฉ 2024 ุฌููุน ุงูุญููู ูุญููุธุฉ | ๐ค ูุฏุนูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // ๐ฅ API Key ุงูุฎุงุต ุจู - ุชู ุชูุนููู!
        const GEMINI_API_KEY = "AIzaSyBAZX-U_9ZIBsYAYOYaoI3iO7-qeEeOCVk";
        const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent";
        
        // ูุชุบูุฑุงุช ุงูุชุทุจูู
        let userData = null;
        let currentWeek = 1;
        let currentPage = 'calculator';
        
        // ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            // ุฅุฎูุงุก ุดุงุดุฉ ุงูุชุญููู ุจุนุฏ ุซุงููุชูู
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                setupEventListeners();
                showNotification('โ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ููุนู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู!', 'success');
            }, 2000);
        });
        
        function setupEventListeners() {
            // ูููุฐุฌ ุงูุญุงุณุจุฉ
            const calculatorForm = document.getElementById('calculatorForm');
            if (calculatorForm) {
                calculatorForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    calculateWithAI();
                });
            }
            
            // ุฃุฒุฑุงุฑ ุงูุชููู ุจูู ุงูุฃุณุงุจูุน
            document.getElementById('prevWeek')?.addEventListener('click', function() {
                if (currentWeek > 1) {
                    currentWeek--;
                    updateWeekDisplay();
                    if (userData) generateMealPlanWithAI();
                }
            });
            
            document.getElementById('nextWeek')?.addEventListener('click', function() {
                if (currentWeek < 4) {
                    currentWeek++;
                    updateWeekDisplay();
                    if (userData) generateMealPlanWithAI();
                }
            });
        }
        
        async function calculateWithAI() {
            // ุฌูุน ุงูุจูุงูุงุช
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const age = parseInt(document.getElementById('age').value);
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const goal = document.getElementById('goal').value;
            const workoutDays = document.getElementById('workoutDays').value;
            const planType = document.getElementById('planType').value;
            const workoutSystem = document.getElementById('workoutSystem').value;
            
            // ุงูุชุญูู ูู ุงูุจูุงูุงุช
            if (!weight || !height || !age) {
                showNotification('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ', 'error');
                return;
            }
            
            const submitBtn = document.querySelector('#calculatorForm button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> ุฌุงุฑู ุงูุญุณุงุจ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู...';
            submitBtn.disabled = true;
            
            try {
                // ุฅุนุฏุงุฏ ุทูุจ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
                const prompt = `
                    ูุณุชุฎุฏู ูุฑูุฏ ุญุณุงุจ ุงุญุชูุงุฌุงุชู ุงูุบุฐุงุฆูุฉ ุจูุงุก ุนูู ูุฐู ุงูุจูุงูุงุช:
                    - ุงููุฒู: ${weight} ูุฌู
                    - ุงูุทูู: ${height} ุณู
                    - ุงูุนูุฑ: ${age} ุณูุฉ
                    - ุงูุฌูุณ: ${gender === 'male' ? 'ุฐูุฑ' : 'ุฃูุซู'}
                    - ุงููุฏู: ${goal === 'cutting' ? 'ุชูุดูู ูุญุฑู ุงูุฏููู' : goal === 'bulking' ? 'ุชุถุฎูู ูุจูุงุก ุงูุนุถูุงุช' : 'ุงููุญุงูุธุฉ ูุงูุชุญุณูู'}
                    - ุฃูุงู ุงูุชูุฑูู: ${workoutDays} ููู ุฃุณุจูุนูุงู
                    - ููุน ุงูุฎุทุฉ: ${planType === 'ramadan' ? 'ุฑูุถุงู' : 'ุนุงุฏู'}
                    - ูุธุงู ุงูุชูุงุฑูู: ${workoutSystem}
                    
                    ุฃุฑุฌู ุญุณุงุจ:
                    1. BMR (ูุนุฏู ุงูุฃูุถ ุงูุฃุณุงุณู)
                    2. TDEE (ุฅุฌูุงูู ุงูุฅููุงู ุงููููู)
                    3. ุงูุณุนุฑุงุช ุงูุญุฑุงุฑูุฉ ุงูููููุฉ ุงูููุงุณุจุฉ ูููุฏู
                    4. ุชูุฒูุน ุงููุงูุฑูุฒ: ุจุฑูุชููุ ูุฑุจูููุฏุฑุงุชุ ุฏููู ุจุงูุฌุฑุงูุงุช
                    
                    ุฃุฑุฌู ุงูุฑุฏ ุจุชูุณูู JSON ููุท:
                    {
                        "calories": ุงูุฑูู,
                        "protein": ุงูุฑูู,
                        "carbs": ุงูุฑูู,
                        "fat": ุงูุฑูู,
                        "tdee": ุงูุฑูู,
                        "bmr": ุงูุฑูู,
                        "recommendations": "ูุตูุญุฉ ูุฎุชุตุฑุฉ ุจุงูุนุฑุจูุฉ"
                    }
                `;
                
                const aiResponse = await callGeminiAPI(prompt);
                
                // ุชุญููู ุงูุงุณุชุฌุงุจุฉ
                let aiData;
                try {
                    const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                    aiData = JSON.parse(jsonMatch ? jsonMatch[0] : aiResponse);
                } catch (e) {
                    // ุฅุฐุง ูุดู ุงูุชุญูููุ ุงุณุชุฎุฏู ุงูุญุณุงุจ ุงููุฏูู
                    aiData = manualCalculation(weight, height, age, gender, goal, workoutDays, planType);
                }
                
                // ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู
                userData = {
                    weight: weight,
                    height: height,
                    age: age,
                    gender: gender,
                    goal: goal,
                    workoutDays: workoutDays,
                    planType: planType,
                    workoutSystem: workoutSystem,
                    calories: parseInt(aiData.calories),
                    protein: parseInt(aiData.protein),
                    carbs: parseInt(aiData.carbs),
                    fat: parseInt(aiData.fat),
                    tdee: parseInt(aiData.tdee),
                    bmr: parseInt(aiData.bmr),
                    recommendations: aiData.recommendations || "ุชูุงูู ุบุฐุงุก ูุชูุงุฒู ููุงุฑุณ ุงูุฑูุงุถุฉ ุจุงูุชุธุงู"
                };
                
                // ุนุฑุถ ุงููุชุงุฆุฌ
                displayNutritionResults(userData);
                
                showNotification('โ ุชู ุญุณุงุจ ุงุญุชูุงุฌุงุชู ุงูุบุฐุงุฆูุฉ ุจูุฌุงุญ!', 'success');
                
            } catch (error) {
                console.error('AI Error:', error);
                showNotification('โ๏ธ ุงุณุชุฎุฏุงู ุงูุญุณุงุจ ุงูุชูููุฏู', 'info');
                userData = manualCalculation(weight, height, age, gender, goal, workoutDays, planType);
                displayNutritionResults(userData);
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }
        
        async function callGeminiAPI(prompt) {
            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 1000
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
                
            } catch (error) {
                console.error('Gemini API Error:', error);
                throw error;
            }
        }
        
        function manualCalculation(weight, height, age, gender, goal, workoutDays, planType) {
            // ุญุณุงุจ BMR
            let bmr;
            if (gender === "male") {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
            
            // ุญุณุงุจ ูุณุชูู ุงููุดุงุท
            const activityLevel = calculateActivityLevel(parseInt(workoutDays));
            let tdee = Math.round(bmr * activityLevel);
            
            // ุชุนุฏูู ุงูุณุนุฑุงุช ุญุณุจ ุงููุฏู
            let calorieTarget, proteinMultiplier;
            switch(goal) {
                case "cutting":
                    calorieTarget = tdee * 0.85;
                    proteinMultiplier = 2.2;
                    break;
                case "bulking":
                    calorieTarget = tdee * 1.15;
                    proteinMultiplier = 1.8;
                    break;
                default:
                    calorieTarget = tdee;
                    proteinMultiplier = 1.6;
            }
            
            // ุชุนุฏูู ูุฑูุถุงู
            if (planType === "ramadan") {
                calorieTarget *= 0.9;
            }
            
            // ุญุณุงุจ ุงููุงูุฑูุฒ
            const proteinGrams = Math.round(weight * proteinMultiplier);
            const fatGrams = Math.round((calorieTarget * 0.25) / 9);
            const carbGrams = Math.round((calorieTarget - (proteinGrams * 4) - (fatGrams * 9)) / 4);
            
            return {
                calories: Math.round(calorieTarget),
                protein: proteinGrams,
                carbs: carbGrams,
                fat: fatGrams,
                tdee: tdee,
                bmr: Math.round(bmr),
                recommendations: `ุชูุงูู ${Math.round(calorieTarget)} ุณุนุฑุฉ ุญุฑุงุฑูุฉ ููููุงูุ ูุน ${proteinGrams}ุบ ุจุฑูุชููุ ${carbGrams}ุบ ูุฑุจูููุฏุฑุงุชุ ${fatGrams}ุบ ุฏููู. ูุงุฑุณ ุงูุฑูุงุถุฉ ุจุงูุชุธุงู.`
            };
        }
        
        function calculateActivityLevel(workoutDays) {
            switch(workoutDays) {
                case 3: return 1.375;
                case 4: return 1.55;
                case 5: return 1.725;
                case 6: return 1.9;
                default: return 1.55;
            }
        }
        
        async function generateMealPlanWithAI() {
            if (!userData) {
                showNotification('ูุฌุจ ุฅุฏุฎุงู ุจูุงูุงุชู ุฃููุงู ูู ุตูุญุฉ ุงูุญุงุณุจุฉ', 'error');
                switchPage('calculator');
                return;
            }
            
            const mealPlanContent = document.getElementById('mealPlanContent');
            const planTypeDisplay = document.getElementById('planTypeDisplay');
            const goalDisplay = document.getElementById('goalDisplay');
            
            // ุชุญุฏูุซ ุงูุนุฑูุถ
            planTypeDisplay.textContent = userData.planType === "ramadan" ? "ุฑูุถุงู" : "ุนุงุฏู";
            goalDisplay.textContent = userData.goal === "cutting" ? "ุชูุดูู" : userData.goal === "bulking" ? "ุชุถุฎูู" : "ูุญุงูุธุฉ";
            updateWeekDisplay();
            
            // ุนุฑุถ ุงูุชุญููู
            mealPlanContent.innerHTML = `
                <div class="text-center py-12">
                    <div class="loading mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                    <p class="text-gray-600 text-lg">๐ค ุฌุงุฑู ุฅูุดุงุก ุฎุทุฉ ุงูุชุบุฐูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู...</p>
                </div>
            `;
            
            try {
                const days = ["ุงูุณุจุช", "ุงูุฃุญุฏ", "ุงูุฅุซููู", "ุงูุซูุงุซุงุก", "ุงูุฃุฑุจุนุงุก", "ุงูุฎููุณ", "ุงูุฌูุนุฉ"];
                let weeklyPlan = "";
                
                // ุฅูุดุงุก ุฎุทุฉ ููู ููู
                for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
                    const dayName = days[dayIndex];
                    const isRamadan = userData.planType === "ramadan";
                    
                    const prompt = isRamadan ? 
                        `ุฃูุดุฆ ุฎุทุฉ ูุฌุจุงุช ูููู ${dayName} ูู ุฑูุถุงู:
                         ุงููุฏู: ${userData.goal === 'cutting' ? 'ุชูุดูู' : userData.goal === 'bulking' ? 'ุชุถุฎูู' : 'ูุญุงูุธุฉ'}
                         ุงูุณุนุฑุงุช: ${userData.calories}
                         ุงูุจุฑูุชูู: ${userData.protein}ุบ
                         ุงููุฑุจูููุฏุฑุงุช: ${userData.carbs}ุบ
                         ุงูุฏููู: ${userData.fat}ุบ
                         
                         ุฃุฑูุฏ:
                         1. ูุฌุจุฉ ุฅูุทุงุฑ ุจุนุฏ ุงููุบุฑุจ
                         2. ูุฌุจุฉ ุณุญูุฑ
                         3. ูุฌุจุชูู ุฎูููุชูู ุจูู ุงูุฅูุทุงุฑ ูุงูุณุญูุฑ
                         4. ุฐูุฑ ุงููููุงุช ูุงูุชุบุฐูุฉ` :
                         
                        `ุฃูุดุฆ ุฎุทุฉ ูุฌุจุงุช ูููู ${dayName}:
                         ุงููุฏู: ${userData.goal === 'cutting' ? 'ุชูุดูู' : userData.goal === 'bulking' ? 'ุชุถุฎูู' : 'ูุญุงูุธุฉ'}
                         ุงูุณุนุฑุงุช: ${userData.calories}
                         ุงูุจุฑูุชูู: ${userData.protein}ุบ
                         ุงููุฑุจูููุฏุฑุงุช: ${userData.carbs}ุบ
                         ุงูุฏููู: ${userData.fat}ุบ
                         
                         ุฃุฑูุฏ:
                         1. ูุฌุจุฉ ูุทูุฑ
                         2. ูุฌุจุฉ ุบุฏุงุก
                         3. ูุฌุจุฉ ุนุดุงุก
                         4. ูุฌุจุชูู ุฎูููุชูู
                         5. ุฐูุฑ ุงููููุงุช ูุงูุชุบุฐูุฉ`;
                    
                    try {
                        const dayPlan = await callGeminiAPI(prompt);
                        weeklyPlan += `
                            <div class="bg-gray-50 rounded-2xl p-6 mb-6">
                                <h4 class="text-xl font-bold text-dark mb-4 pb-3 border-b border-gray-200">${dayName} - ุงูุฃุณุจูุน ${currentWeek}</h4>
                                <div class="prose prose-lg max-w-none text-gray-700">
                                    ${formatAIResponse(dayPlan)}
                                </div>
                            </div>
                        `;
                    } catch (error) {
                        weeklyPlan += `
                            <div class="bg-gray-50 rounded-2xl p-6 mb-6">
                                <h4 class="text-xl font-bold text-dark mb-4 pb-3 border-b border-gray-200">${dayName} - ุงูุฃุณุจูุน ${currentWeek}</h4>
                                ${generateLocalMealPlan(dayIndex, isRamadan)}
                            </div>
                        `;
                    }
                }
                
                mealPlanContent.innerHTML = `
                    <div class="space-y-8">
                        ${weeklyPlan}
                        <div class="bg-gradient-to-r from-blue-100 to-green-100 rounded-2xl p-6">
                            <h4 class="font-bold text-dark mb-4">๐ ูุตุงุฆุญ ุงูุฃุณุจูุน ${currentWeek}:</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-bold text-gray-800 mb-3">๐ฅฆ ูุตุงุฆุญ ุบุฐุงุฆูุฉ:</h5>
                                    <ul class="space-y-2 text-gray-700">
                                        <li>โข ุงุดุฑุจ 3-4 ูุชุฑ ูุงุก ููููุงู</li>
                                        <li>โข ุชูุงูู ุงูุฎุถุฑูุงุช ูุน ูู ูุฌุจุฉ</li>
                                        <li>โข ุชุฌูุจ ุงูุณูุฑูุงุช ุงููุถุงูุฉ</li>
                                        ${userData.planType === 'ramadan' ? '<li>โข ุงุณุชูุฑ ูู ุดุฑุจ ุงููุงุก ุจูู ุงูุฅูุทุงุฑ ูุงูุณุญูุฑ</li>' : ''}
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-bold text-gray-800 mb-3">๐ฏ ุญุณุจ ูุฏูู:</h5>
                                    <ul class="space-y-2 text-gray-700">
                                        ${userData.goal === 'cutting' ? 
                                            '<li>โข ุฑูุฒ ุนูู ุงูุจุฑูุชูู ูุน ูู ูุฌุจุฉ</li><li>โข ููู ุงููุฑุจูููุฏุฑุงุช ุงููุณุงุก</li><li>โข ุงูุด 30 ุฏูููุฉ ููููุงู</li>' :
                                          userData.goal === 'bulking' ?
                                            '<li>โข ุฒุฏ ุงููุฑุจูููุฏุฑุงุช ุจุนุฏ ุงูุชูุฑูู</li><li>โข ุชูุงูู ูุฌุจุฉ ูุจู ุงูููู</li><li>โข ุฑูุฒ ุนูู ุชูุงุฑูู ุงูููุฉ</li>' :
                                            '<li>โข ุญุงูุธ ุนูู ุชูุงุฒู ุงููุฌุจุงุช</li><li>โข ูุงุฑุณ ุงูุฑูุงุถุฉ ุจุงูุชุธุงู</li><li>โข ุชุงุจุน ูุฒูู ุฃุณุจูุนูุงู</li>'
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                showNotification('โ ุชู ุฅูุดุงุก ุฎุทุฉ ุงูุชุบุฐูุฉ ุจูุฌุงุญ!', 'success');
                
            } catch (error) {
                console.error('Meal Plan Error:', error);
                mealPlanContent.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">๐</div>
                        <p class="text-gray-600 text-lg">ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุฎุทุฉ ุงูุชุบุฐูุฉ</p>
                        <button onclick="generateMealPlanWithAI()" class="mt-4 gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200">
                            ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                        </button>
                    </div>
                `;
            }
        }
        
        async function generateWorkoutPlanWithAI() {
            if (!userData) {
                showNotification('ูุฌุจ ุฅุฏุฎุงู ุจูุงูุงุชู ุฃููุงู ูู ุตูุญุฉ ุงูุญุงุณุจุฉ', 'error');
                switchPage('calculator');
                return;
            }
            
            const workoutPlanContent = document.getElementById('workoutPlanContent');
            const workoutSystemDisplay = document.getElementById('workoutSystemDisplay');
            const workoutDaysDisplay = document.getElementById('workoutDaysDisplay');
            const workoutGoalDisplay = document.getElementById('workoutGoalDisplay');
            
            // ุชุญุฏูุซ ุงูุนุฑูุถ
            workoutSystemDisplay.textContent = getWorkoutSystemText(userData.workoutSystem);
            workoutDaysDisplay.textContent = userData.workoutDays;
            workoutGoalDisplay.textContent = userData.goal === "cutting" ? "ุชูุดูู" : userData.goal === "bulking" ? "ุชุถุฎูู" : "ูุญุงูุธุฉ";
            
            // ุนุฑุถ ุงูุชุญููู
            workoutPlanContent.innerHTML = `
                <div class="text-center py-12">
                    <div class="loading mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                    <p class="text-gray-600 text-lg">๐ค ุฌุงุฑู ุฅูุดุงุก ุจุฑูุงูุฌ ุงูุชูุงุฑูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู...</p>
                </div>
            `;
            
            try {
                const prompt = `ุฃูุดุฆ ุจุฑูุงูุฌ ุชูุงุฑูู ${getWorkoutSystemText(userData.workoutSystem)} ูู ${userData.workoutDays} ุฃูุงู ุฃุณุจูุนูุงู.
ุงููุฏู: ${userData.goal === 'cutting' ? 'ุชูุดูู' : userData.goal === 'bulking' ? 'ุชุถุฎูู' : 'ูุญุงูุธุฉ'}
ุงููุฒู: ${userData.weight} ูุฌู
ุงูุณุนุฑุงุช ุงูููููุฉ: ${userData.calories}
ุงูุจุฑูุชูู ุงููููู: ${userData.protein}ุบ

ุงููุชุทูุจุงุช:
1. ุฌุฏูู ุฃุณุจูุนู ูุงูู
2. ููู ููู: ุงูุชูุงุฑููุ ุงููุฌููุนุงุชุ ุงูุชูุฑุงุฑุงุชุ ุงูุฑุงุญุฉ
3. ุฅุฑุดุงุฏุงุช ููุชูููู ุงูุตุญูุญ
4. ูุตุงุฆุญ ููุงุณุชุดูุงุก
5. ${userData.goal === 'cutting' ? 'ุฃุถู ุชูุงุฑูู ูุงุฑุฏูู' : 'ุฑูุฒ ุนูู ุชูุงุฑูู ุงูููุฉ'}
6. ุงุณุชุฎุฏู ุฃุณูุงุก ุงูุชูุงุฑูู ุจุงูุนุฑุจูุฉ`;

                const response = await callGeminiAPI(prompt);
                
                workoutPlanContent.innerHTML = `
                    <div class="space-y-8">
                        <div class="prose prose-lg max-w-none">
                            ${formatAIResponse(response)}
                        </div>
                        <div class="bg-gradient-to-r from-blue-100 to-green-100 rounded-2xl p-6">
                            <h4 class="font-bold text-dark mb-4">๐ก ูุตุงุฆุญ ุฅุถุงููุฉ:</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-bold text-gray-800 mb-3">๐๏ธโโ๏ธ ูุตุงุฆุญ ุงูุชูุฑูู:</h5>
                                    <ul class="space-y-2 text-gray-700">
                                        <li>โข ุฅุญูุงุก 10 ุฏูุงุฆู ูุจู ุงูุชูุฑูู</li>
                                        <li>โข ุญุงูุธ ุนูู ุงูุดูู ุงูุตุญูุญ ููุชูุงุฑูู</li>
                                        <li>โข ุฒุฏ ุงูุฃูุฒุงู ุชุฏุฑูุฌูุงู</li>
                                        <li>โข ุงุณุชุฑุญ ุจูู ุงููุฌููุนุงุช 60-90 ุซุงููุฉ</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-bold text-gray-800 mb-3">๐ ูุตุงุฆุญ ุบุฐุงุฆูุฉ ููุชูุฑูู:</h5>
                                    <ul class="space-y-2 text-gray-700">
                                        <li>โข ุชูุงูู ูุฌุจุฉ ุจุฑูุชูู ูุจู ุงูุชูุฑูู ุจุณุงุนุฉ</li>
                                        <li>โข ุงุดุฑุจ ุงููุงุก ุฃุซูุงุก ูุจุนุฏ ุงูุชูุฑูู</li>
                                        <li>โข ุชูุงูู ูุฑุจูููุฏุฑุงุช ุจุนุฏ ุงูุชูุฑูู</li>
                                        <li>โข ูุงู 7-8 ุณุงุนุงุช ููุงุณุชุดูุงุก</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                showNotification('โ ุชู ุฅูุดุงุก ุจุฑูุงูุฌ ุงูุชูุงุฑูู ุจูุฌุงุญ!', 'success');
                
            } catch (error) {
                console.error('Workout Plan Error:', error);
                workoutPlanContent.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">๐</div>
                        <p class="text-gray-600 text-lg">ุญุฏุซ ุฎุทุฃ ูู ุฅูุดุงุก ุจุฑูุงูุฌ ุงูุชูุงุฑูู</p>
                        <button onclick="generateWorkoutPlanWithAI()" class="mt-4 gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200">
                            ุฅุนุงุฏุฉ ุงููุญุงููุฉ
                        </button>
                    </div>
                `;
            }
        }
        
        // ุฏูุงู ูุณุงุนุฏุฉ
        function getWorkoutSystemText(system) {
            const systems = {
                'bro_split': 'ุจุฑู ุณุจูุช (ุนุถูุฉ ูุงุญุฏุฉ ูู ุงูููู)',
                'push_pull_legs': 'ุจูุด ุจูู ููุฌ (ุฏูุน-ุณุญุจ-ุฃุฑุฌู)',
                'arnold_split': 'ุฃุฑูููุฏ ุณุจูุช',
                'full_body': 'ุชูุงุฑูู ูุงููุฉ ุงูุฌุณู'
            };
            return systems[system] || system;
        }
        
        function formatAIResponse(response) {
            return response
                .replace(/\*\*(.*?)\*\*/g, '<strong class="text-blue-600">$1</strong>')
                .replace(/\n\n/g, '</p><p class="mt-4">')
                .replace(/\n/g, '<br>')
                .replace(/### (.*?)(\n|$)/g, '<h3 class="text-xl font-bold mt-6 mb-3 text-gray-800">$1</h3>')
                .replace(/## (.*?)(\n|$)/g, '<h3 class="text-lg font-bold mt-4 mb-2 text-gray-800">$1</h3>')
                .replace(/# (.*?)(\n|$)/g, '<h2 class="text-2xl font-bold mt-8 mb-4 text-gray-900">$1</h2>');
        }
        
        function generateLocalMealPlan(dayIndex, isRamadan) {
            const meals = {
                breakfast: ["ุดููุงู ูุน ุญููุจ ูููุฒ", "ุนุฌุฉ ุจูุถ ูุน ุฎุถุงุฑ", "ุณููุฐู ุจุฑูุชูู ุจุงูุชูุฑ"],
                lunch: ["ุตุฏุฑ ุฏุฌุงุฌ ูุดูู ูุน ุฃุฑุฒ ุจูู", "ุณูู ุณูููู ูุน ุจุทุงุทุง ุญููุฉ", "ูุญู ุจูุฑู ูุน ุฎุถุงุฑ ุณูุชูู"],
                dinner: ["ุณูุทุฉ ุชููุฉ ูุน ุฎุถุงุฑ", "ุฃููููุช ุจูุถ ูุน ุฌุจู", "ุณูููู ูุน ุจุฑูููู"],
                snacks: ["ุชูุงุญุฉ ูุน ุฒุจุฏุฉ ููู ุณูุฏุงูู", "ููุณุฑุงุช ูุดููุฉ", "ุจุฑูุชูู ุดูู"]
            };
            
            const idx = dayIndex % 3;
            
            if (isRamadan) {
                return `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-xl">
                            <h5 class="font-bold text-green-600 mb-2">๐ฝ๏ธ ุงูุฅูุทุงุฑ</h5>
                            <p>${meals.lunch[idx]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.4)} ุณุนุฑุฉ</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl">
                            <h5 class="font-bold text-blue-600 mb-2">๐ ุณุญูุฑ</h5>
                            <p>${meals.dinner[idx]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.3)} ุณุนุฑุฉ</p>
                        </div>
                        <div class="bg-white p-4 rounded-xl">
                            <h5 class="font-bold text-yellow-600 mb-2">๐ฅ ูุฌุจุงุช ุฎูููุฉ</h5>
                            <p>${meals.snacks[idx]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.3)} ุณุนุฑุฉ</p>
                        </div>
                    </div>
                `;
            }
            
            return `
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-white p-4 rounded-xl">
                        <h5 class="font-bold text-green-600 mb-2">๐ ุงููุทูุฑ</h5>
                        <p>${meals.breakfast[idx]}</p>
                        <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.25)} ุณุนุฑุฉ</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl">
                        <h5 class="font-bold text-blue-600 mb-2">โ๏ธ ุงูุบุฏุงุก</h5>
                        <p>${meals.lunch[idx]}</p>
                        <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.35)} ุณุนุฑุฉ</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl">
                        <h5 class="font-bold text-purple-600 mb-2">๐ ุงูุนุดุงุก</h5>
                        <p>${meals.dinner[idx]}</p>
                        <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.25)} ุณุนุฑุฉ</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl">
                        <h5 class="font-bold text-yellow-600 mb-2">๐ฅ ูุฌุจุงุช ุฎูููุฉ</h5>
                        <p>${meals.snacks[idx]}</p>
                        <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.15)} ุณุนุฑุฉ</p>
                    </div>
                </div>
            `;
        }
        
        function displayNutritionResults(data) {
            const resultsDiv = document.getElementById('results');
            if (!resultsDiv) return;
            
            const goalText = data.goal === "cutting" ? "ุชูุดูู" : data.goal === "bulking" ? "ุชุถุฎูู" : "ูุญุงูุธุฉ";
            const planTypeText = data.planType === "ramadan" ? "ุฑูุถุงู" : "ุนุงุฏู";
            
            resultsDiv.innerHTML = `
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-blue-600 mb-2">${data.calories}</div>
                        <div class="text-gray-600">ุณุนุฑุฉ ุญุฑุงุฑูุฉ</div>
                        <div class="text-sm text-gray-500 mt-1">ุงููุฏู ุงููููู</div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-green-600 mb-2">${data.protein} ุบ</div>
                        <div class="text-gray-600">ุจุฑูุชูู</div>
                        <div class="text-sm text-gray-500 mt-1">${data.protein * 4} ุณุนุฑุฉ</div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-yellow-600 mb-2">${data.carbs} ุบ</div>
                        <div class="text-gray-600">ูุฑุจูููุฏุฑุงุช</div>
                        <div class="text-sm text-gray-500 mt-1">${data.carbs * 4} ุณุนุฑุฉ</div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-purple-600 mb-2">${data.fat} ุบ</div>
                        <div class="text-gray-600">ุฏููู</div>
                        <div class="text-sm text-gray-500 mt-1">${data.fat * 9} ุณุนุฑุฉ</div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-gray-700 mb-2">${data.tdee}</div>
                        <div class="text-gray-600">TDEE</div>
                        <div class="text-sm text-gray-500 mt-1">ุฅุฌูุงูู ุงูุฅููุงู</div>
                    </div>
                    
                    <div class="bg-red-50 p-4 rounded-xl text-center">
                        <div class="text-2xl font-bold text-red-600 mb-2">${data.bmr}</div>
                        <div class="text-gray-600">BMR</div>
                        <div class="text-sm text-gray-500 mt-1">ูุนุฏู ุงูุฃูุถ ุงูุฃุณุงุณู</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-blue-100 to-green-100 rounded-xl p-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-robot text-blue-600 text-xl ml-2"></i>
                        <h4 class="font-bold text-dark">๐ค ุชูุตูุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู:</h4>
                    </div>
                    <p class="text-gray-700 mb-4">${data.recommendations}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-blue-500 rounded-full ml-2"></div>
                            <span>ุงููุฏู: <span class="font-bold">${goalText}</span></span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-green-500 rounded-full ml-2"></div>
                            <span>ููุน ุงูุฎุทุฉ: <span class="font-bold">${planTypeText}</span></span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full ml-2"></div>
                            <span>ุฃูุงู ุงูุชูุฑูู: <span class="font-bold">${data.workoutDays} ููู ุฃุณุจูุนูุงู</span></span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-purple-500 rounded-full ml-2"></div>
                            <span>ูุธุงู ุงูุชูุงุฑูู: <span class="font-bold">${getWorkoutSystemText(data.workoutSystem)}</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="text-center pt-6">
                    <button onclick="switchPage('meal-plan')" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200 transform hover:scale-[1.02] shadow-lg">
                        <i class="fas fa-utensils ml-2"></i> ุดุงูุฏ ุฎุทุฉ ุงูุชุบุฐูุฉ
                    </button>
                </div>
            `;
        }
        
        function switchPage(pageName) {
            // ุฅุฎูุงุก ูู ุงูุตูุญุงุช
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // ุฅุฒุงูุฉ ุงููุดุงุท ูู ูู ุงูุฃุฒุฑุงุฑ
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('nav-active');
            });
            
            // ุฅุธูุงุฑ ุงูุตูุญุฉ ุงููุทููุจุฉ
            const pageElement = document.getElementById(`${pageName}-page`);
            if (pageElement) {
                pageElement.classList.add('active');
                
                // ุฅุถุงูุฉ ุงููุดุงุท ููุฒุฑ ุงููุญุฏุฏ
                const activeButton = Array.from(document.querySelectorAll('.nav-item')).find(btn => 
                    btn.getAttribute('onclick')?.includes(`'${pageName}'`)
                );
                if (activeButton) {
                    activeButton.classList.add('nav-active');
                }
                
                // ุชุญุฏูุซ ุงููุญุชูู ุฅุฐุง ูุงู ููุงู ุจูุงูุงุช
                if (userData) {
                    if (pageName === 'meal-plan') {
                        generateMealPlanWithAI();
                    } else if (pageName === 'workout') {
                        generateWorkoutPlanWithAI();
                    }
                }
            }
        }
        
        function updateWeekDisplay() {
            const weekDisplay = document.getElementById('weekDisplay');
            if (weekDisplay) {
                weekDisplay.textContent = `ุงูุฃุณุจูุน ${currentWeek}`;
                
                // ุชุญุฏูุซ ุญุงูุฉ ุงูุฃุฒุฑุงุฑ
                const prevWeekBtn = document.getElementById('prevWeek');
                const nextWeekBtn = document.getElementById('nextWeek');
                
                if (prevWeekBtn) {
                    prevWeekBtn.disabled = currentWeek === 1;
                    prevWeekBtn.classList.toggle('opacity-50', currentWeek === 1);
                }
                
                if (nextWeekBtn) {
                    nextWeekBtn.disabled = currentWeek === 4;
                    nextWeekBtn.classList.toggle('opacity-50', currentWeek === 4);
                }
            }
        }
        
        function showNotification(message, type = 'info') {
            // ุฅุฒุงูุฉ ุฃู ุฅุดุนุงุฑุงุช ุณุงุจูุฉ
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            // ุฅูุดุงุก ุนูุตุฑ ุงูุฅุดุนุงุฑ
            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg text-white font-bold transform transition-all duration-300 ${
                type === 'success' ? 'bg-gradient-to-r from-green-500 to-green-600' :
                type === 'error' ? 'bg-gradient-to-r from-red-500 to-red-600' :
                'bg-gradient-to-r from-blue-500 to-blue-600'
            }`;
            notification.textContent = message;
            
            // ุฅุถุงูุฉ ููุฅุดุนุงุฑ
            document.body.appendChild(notification);
            
            // ุฅุฒุงูุฉ ุจุนุฏ 3 ุซูุงูู
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // ุฌุนู ุงูุฏูุงู ูุชุงุญุฉ ุนุงูููุงู
        window.switchPage = switchPage;
        window.generateWorkoutPlanWithAI = generateWorkoutPlanWithAI;
        window.generateMealPlanWithAI = generateMealPlanWithAI;
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <base target="_self">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙŠØ§Ù‚Ø© ÙˆØ§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø· Ø§Ù„ØªØºØ°ÙŠØ© ÙˆØ§Ù„ØªÙ…Ø§Ø±ÙŠÙ†">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA7POxxSjiEHElUMEoQ90TTlBs2WBEE18g",
            authDomain: "fittnes-web.firebaseapp.com",
            projectId: "fittnes-web",
            storageBucket: "fittnes-web.firebasestorage.app",
            messagingSenderId: "1043684216161",
            appId: "1:1043684216161:web:7ffa29e8c215bcc480c920",
            measurementId: "G-8BQBEPH5Z8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseCreateUser = createUserWithEmailAndPassword;
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseSignOut = signOut;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseDoc = doc;
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: "#3B82F6",
                        secondary: "#10B981",
                        accent: "#F59E0B",
                        dark: "#1F2937",
                        light: "#F9FAFB"
                    },
                    fontFamily: {
                        'cairo': ['Cairo', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .nav-active {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .meal-card {
            transition: all 0.3s ease;
        }
        
        .meal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 font-cairo">
    
    <!-- Login/Register Page -->
    <div id="auth-page" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect rounded-3xl shadow-2xl p-8 max-w-md w-full">
            <div class="text-center mb-10">
                <div class="inline-block p-4 rounded-2xl mb-4 gradient-bg">
                    <i class="fas fa-dumbbell text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-dark mb-2">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙŠØ§Ù‚Ø©</h1>
                <p class="text-gray-600">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø­ÙŠØ§Ø© ØµØ­ÙŠØ© Ø£ÙØ¶Ù„</p>
            </div>
            
            <div id="login-form" class="space-y-6">
                <h2 class="text-xl font-bold text-dark mb-6 text-center">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="login-email" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="example@email.com">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="login-password" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="********">
                    </div>
                </div>
                
                <button id="login-btn" class="w-full gradient-bg hover:opacity-90 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg">
                    <i class="fas fa-sign-in-alt ml-2"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
                
                <p class="text-center text-gray-600">
                    Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ 
                    <a href="#" id="show-register" class="text-primary font-bold hover:underline">Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a>
                </p>
            </div>
            
            <div id="register-form" class="space-y-6 hidden">
                <h2 class="text-xl font-bold text-dark mb-6 text-center">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" id="register-name" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" id="register-email" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="example@email.com">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="register-password" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="********">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="register-confirm-password" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="********">
                    </div>
                </div>
                
                <button id="register-btn" class="w-full gradient-bg hover:opacity-90 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg">
                    <i class="fas fa-user-plus ml-2"></i>
                    Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
                </button>
                
                <p class="text-center text-gray-600">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ 
                    <a href="#" id="show-login" class="text-primary font-bold hover:underline">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden Initially) -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto px-4 py-4">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center space-x-3 space-x-reverse mb-4 md:mb-0">
                        <div class="bg-white p-2 rounded-full">
                            <i class="fas fa-dumbbell text-primary text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl md:text-3xl font-bold">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙŠØ§Ù‚Ø© ÙˆØ§Ù„ØªØºØ°ÙŠØ©</h1>
                            <p class="text-blue-100 text-sm">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="user-name"></span></p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <nav class="flex space-x-2 space-x-reverse">
                            <a href="#" data-page="calculator" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200 nav-active">
                                <i class="fas fa-calculator ml-2"></i>Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
                            </a>
                            <a href="#" data-page="meal-plan" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200">
                                <i class="fas fa-utensils ml-2"></i>Ø®Ø·Ø© Ø§Ù„ØªØºØ°ÙŠØ©
                            </a>
                            <a href="#" data-page="workout" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition-colors duration-200">
                                <i class="fas fa-dumbbell ml-2"></i>Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†
                            </a>
                        </nav>
                        <button id="logout-btn" class="px-4 py-2 bg-white text-primary rounded-xl hover:bg-gray-100 transition-colors duration-200">
                            <i class="fas fa-sign-out-alt ml-2"></i>
                            Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-4 py-8">
            <!-- Calculator Page -->
            <section id="calculator-page" class="page active">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-dark mb-4">Ø§Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø®Ø·Ø· ØªØºØ°ÙŠØ© ÙˆØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Input Form -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="flex items-center mb-6">
                            <div class="bg-primary p-3 rounded-full ml-4">
                                <i class="fas fa-user text-white text-xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-dark">Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                        </div>
                        
                        <form id="calculatorForm" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-2">
                                    <label class="block text-gray-700 font-medium">Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)</label>
                                    <input type="number" id="weight" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="Ù…Ø«Ø§Ù„: 75" required min="30" max="200">
                                </div>
                                
                                <div class="space-y-2">
                                    <label class="block text-gray-700 font-medium">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label>
                                    <input type="number" id="height" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="Ù…Ø«Ø§Ù„: 175" required min="100" max="250">
                                </div>
                                
                                <div class="space-y-2">
                                    <label class="block text-gray-700 font-medium">Ø§Ù„Ø¹Ù…Ø± (Ø³Ù†Ø©)</label>
                                    <input type="number" id="age" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200" placeholder="Ù…Ø«Ø§Ù„: 25" required min="15" max="80">
                                </div>
                                
                                <div class="space-y-2">
                                    <label class="block text-gray-700 font-medium">Ø§Ù„Ø¬Ù†Ø³</label>
                                    <div class="flex space-x-4 space-x-reverse">
                                        <label class="flex items-center space-x-2 space-x-reverse cursor-pointer">
                                            <input type="radio" name="gender" value="male" class="text-primary" checked>
                                            <span>Ø°ÙƒØ±</span>
                                        </label>
                                        <label class="flex items-center space-x-2 space-x-reverse cursor-pointer">
                                            <input type="radio" name="gender" value="female" class="text-primary">
                                            <span>Ø£Ù†Ø«Ù‰</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="space-y-2">
                                    <label class="block text-gray-700 font-medium">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
                                    <select id="goal" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200">
                                        <option value="cutting">ØªÙ†Ø´ÙŠÙ ÙˆØ­Ø±Ù‚ Ø§Ù„Ø¯Ù‡ÙˆÙ†</option>
                                        <option value="bulking">ØªØ¶Ø®ÙŠÙ… ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª</option>
                                        <option value="maintain" selected>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†</option>
                                    </select>
                                </div>

                                <div class="space-y-2">
                                    <label class="block text-gray-700 font-medium">Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</label>
                                    <select id="workoutSystem" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200">
                                        <option value="bro_split">Ø¨Ø±Ùˆ Ø³Ø¨Ù„Øª (Ø¹Ø¶Ù„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„ÙŠÙˆÙ…)</option>
                                        <option value="push_pull_legs">Ø¨ÙˆØ´ Ø¨ÙˆÙ„ Ù„ÙŠØ¬ (Ø¯ÙØ¹-Ø³Ø­Ø¨-Ø£Ø±Ø¬Ù„)</option>
                                        <option value="arnold_split">Ø£Ø±Ù†ÙˆÙ„Ø¯ Ø³Ø¨Ù„Øª</option>
                                        <option value="full_body">ØªÙ…Ø§Ø±ÙŠÙ† ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ø¬Ø³Ù…</option>
                                    </select>
                                </div>

                                <div class="space-y-2">
                                    <label class="block text-gray-700 font-medium">Ø£ÙŠØ§Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</label>
                                    <select id="workoutDays" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200">
                                        <option value="3">3 Ø£ÙŠØ§Ù…</option>
                                        <option value="4" selected>4 Ø£ÙŠØ§Ù…</option>
                                        <option value="5">5 Ø£ÙŠØ§Ù…</option>
                                        <option value="6">6 Ø£ÙŠØ§Ù…</option>
                                    </select>
                                </div>

                                <div class="space-y-2">
                                    <label class="block text-gray-700 font-medium">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø©</label>
                                    <select id="planType" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all duration-200">
                                        <option value="normal">Ø£ÙŠØ§Ù… Ø¹Ø§Ø¯ÙŠØ©</option>
                                        <option value="ramadan">Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù†</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button type="submit" class="w-full gradient-bg hover:opacity-90 text-white font-bold py-4 px-6 rounded-xl transition-all duration-200 transform hover:scale-[1.02] shadow-lg">
                                <i class="fas fa-robot ml-2"></i>
                                Ø§Ø­Ø³Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                            </button>
                        </form>
                    </div>
                    
                    <!-- Results Display -->
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="flex items-center mb-6">
                            <div class="bg-secondary p-3 rounded-full ml-4">
                                <i class="fas fa-chart-line text-white text-xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-dark">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                        </div>
                        
                        <div id="results" class="space-y-6">
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">ğŸ¤–</div>
                                <p class="text-gray-500 text-lg">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø§Ø­Ø³Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ"</p>
                                <p class="text-gray-400 mt-2">Ø³ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø­Ø³Ø§Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Meal Plan Page -->
            <section id="meal-plan-page" class="page">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-dark mb-4">Ø®Ø·Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">Ø®Ø·Ø© ÙˆØ¬Ø¨Ø§Øª Ù…ØªÙ†ÙˆØ¹Ø© Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ… Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø± (Ù…ÙˆÙ„Ø¯Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)</p>
                </div>
                
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div class="p-8 border-b border-gray-100">
                        <div class="flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h3 class="text-2xl font-bold text-dark mb-2">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h3>
                                <div class="flex flex-wrap items-center gap-2 mt-2">
                                    <span class="px-4 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium" id="planTypeDisplay">-</span>
                                    <span class="px-4 py-1 bg-secondary/10 text-secondary rounded-full text-sm font-medium" id="goalDisplay">-</span>
                                    <span class="px-4 py-1 bg-accent/10 text-accent rounded-full text-sm font-medium" id="ai-badge">ğŸ¤– Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
                                </div>
                            </div>
                            <div class="flex space-x-4 space-x-reverse mt-6 md:mt-0">
                                <button id="prevWeek" class="px-5 py-2 border-2 border-gray-200 rounded-xl hover:bg-gray-50 transition-colors duration-200">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                                <span id="weekDisplay" class="px-6 py-2 font-bold text-lg text-dark">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1</span>
                                <button id="nextWeek" class="px-5 py-2 border-2 border-gray-200 rounded-xl hover:bg-gray-50 transition-colors duration-200">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-8" id="mealPlanContent">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ -->
                        <div class="text-center py-16">
                            <div class="text-6xl mb-4">ğŸ½ï¸</div>
                            <p class="text-gray-500 text-lg">ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹</p>
                            <button onclick="switchPage('calculator')" class="mt-6 gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200 transform hover:scale-[1.02] shadow-lg">
                                Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø­Ø§Ø³Ø¨Ø©
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Workout Plans Page -->
            <section id="workout-page" class="page">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold text-dark mb-4">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</h2>
                    <p class="text-gray-600 max-w-2xl mx-auto">Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ (Ù…ÙˆÙ„Ø¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)</p>
                </div>
                
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="mb-8 p-6 bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl">
                        <div class="flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h3 class="text-xl font-bold text-dark mb-2" id="workoutSystemDisplay">Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</h3>
                                <div class="flex flex-wrap gap-2">
                                    <span class="px-3 py-1 bg-primary text-white rounded-full text-sm font-medium">
                                        <i class="fas fa-calendar ml-1"></i> <span id="workoutDaysDisplay">-</span> Ø£ÙŠØ§Ù… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹
                                    </span>
                                    <span class="px-3 py-1 bg-secondary text-white rounded-full text-sm font-medium">
                                        <i class="fas fa-bullseye ml-1"></i> <span id="workoutGoalDisplay">-</span>
                                    </span>
                                </div>
                            </div>
                            <div class="mt-4 md:mt-0">
                                <button onclick="generateWorkoutPlanWithAI()" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg">
                                    <i class="fas fa-sync-alt ml-2"></i>
                                    ØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="workoutPlanContent">
                        <div class="text-center py-16">
                            <div class="text-6xl mb-4">ğŸ’ª</div>
                            <p class="text-gray-500 text-lg">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</p>
                            <p class="text-gray-400 mt-2">ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="bg-gradient-to-r from-gray-800 to-gray-900 text-white py-12 mt-16">
            <div class="container mx-auto px-4 text-center">
                <div class="flex flex-col items-center mb-8">
                    <div class="bg-white p-3 rounded-full mb-4">
                        <i class="fas fa-dumbbell text-primary text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù„ÙŠØ§Ù‚Ø© ÙˆØ§Ù„ØªØºØ°ÙŠØ©</h3>
                    <p class="text-gray-400 max-w-md">Ø®Ø·Ø· ØªØºØ°ÙŠØ© ÙˆØªÙ…Ø§Ø±ÙŠÙ† Ù…Ø®ØµØµØ© Ù„Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
                </div>
                
                <div class="border-t border-gray-700 pt-8 text-gray-400">
                    <p>Â© 2024 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© | ğŸ¤– Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        // API Configuration
        const DEEPSEEK_API_KEY = "sk-ab32e91009014e1fa3c0d43d0f2813bd";
        const DEEPSEEK_API_URL = "https://api.deepseek.com/v1/chat/completions";

        // Application State
        let currentWeek = 1;
        let userData = null;
        let currentUser = null;

        // Initialize
        document.addEventListener("DOMContentLoaded", async function() {
            await setupFirebaseAuth();
            setupEventListeners();
        });

        async function setupFirebaseAuth() {
            try {
                if (!window.firebaseOnAuthStateChanged) {
                    setTimeout(setupFirebaseAuth, 100);
                    return;
                }

                window.firebaseOnAuthStateChanged(window.firebaseAuth, (user) => {
                    if (user) {
                        currentUser = user;
                        showMainApp(user);
                    } else {
                        showAuthPage();
                    }
                });

                document.getElementById('show-register')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('login-form').classList.add('hidden');
                    document.getElementById('register-form').classList.remove('hidden');
                });

                document.getElementById('show-login')?.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('register-form').classList.add('hidden');
                    document.getElementById('login-form').classList.remove('hidden');
                });

                document.getElementById('login-btn')?.addEventListener('click', handleLogin);
                document.getElementById('register-btn')?.addEventListener('click', handleRegister);
                document.getElementById('logout-btn')?.addEventListener('click', handleLogout);

            } catch (error) {
                console.error("Firebase setup error:", error);
            }
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showNotification("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", "error");
                return;
            }

            const btn = document.getElementById('login-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
            btn.disabled = true;

            try {
                await window.firebaseSignIn(window.firebaseAuth, email, password);
                showNotification("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­", "success");
            } catch (error) {
                console.error("Login error:", error);
                showNotification(getAuthErrorMessage(error.code), "error");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function handleRegister() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            if (!name || !email || !password || !confirmPassword) {
                showNotification("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„", "error");
                return;
            }

            if (password !== confirmPassword) {
                showNotification("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©", "error");
                return;
            }

            if (password.length < 6) {
                showNotification("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error");
                return;
            }

            const btn = document.getElementById('register-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...';
            btn.disabled = true;

            try {
                const userCredential = await window.firebaseCreateUser(window.firebaseAuth, email, password);
                
                await window.firebaseSetDoc(
                    window.firebaseDoc(window.firebaseDb, "users", userCredential.user.uid),
                    {
                        name: name,
                        email: email,
                        createdAt: new Date().toISOString()
                    }
                );

                showNotification("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
            } catch (error) {
                console.error("Register error:", error);
                showNotification(getAuthErrorMessage(error.code), "error");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function handleLogout() {
            try {
                await window.firebaseSignOut(window.firebaseAuth);
                showNotification("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­", "success");
            } catch (error) {
                console.error("Logout error:", error);
                showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬", "error");
            }
        }

        function getAuthErrorMessage(errorCode) {
            const messages = {
                'auth/invalid-email': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­',
                'auth/user-disabled': 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„',
                'auth/user-not-found': 'Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯',
                'auth/wrong-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
                'auth/email-already-in-use': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„',
                'auth/weak-password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹',
                'auth/operation-not-allowed': 'Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§'
            };
            return messages[errorCode] || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹';
        }

        function showMainApp(user) {
            document.getElementById('auth-page').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('user-name').textContent = user.displayName || user.email.split('@')[0];
        }

        function showAuthPage() {
            document.getElementById('auth-page').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }

        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    switchPage(page);
                });
            });

            // Calculator form
            const calculatorForm = document.getElementById("calculatorForm");
            if (calculatorForm) {
                calculatorForm.addEventListener("submit", function(e) {
                    e.preventDefault();
                    calculateWithAI();
                });
            }
            
            // Week navigation
            const prevWeekBtn = document.getElementById("prevWeek");
            const nextWeekBtn = document.getElementById("nextWeek");
            
            if (prevWeekBtn) {
                prevWeekBtn.addEventListener("click", function() {
                    if (currentWeek > 1) {
                        currentWeek--;
                        updateWeekDisplay();
                        if (userData) generateMealPlanWithAI();
                    }
                });
            }
            
            if (nextWeekBtn) {
                nextWeekBtn.addEventListener("click", function() {
                    if (currentWeek < 4) {
                        currentWeek++;
                        updateWeekDisplay();
                        if (userData) generateMealPlanWithAI();
                    }
                });
            }
        }

        async function calculateWithAI() {
            // Collect user data
            const weight = parseFloat(document.getElementById("weight").value);
            const height = parseFloat(document.getElementById("height").value);
            const age = parseInt(document.getElementById("age").value);
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const goal = document.getElementById("goal").value;
            const workoutSystem = document.getElementById("workoutSystem").value;
            const workoutDays = document.getElementById("workoutDays").value;
            const planType = document.getElementById("planType").value;
            
            // Validation
            if (!weight || !height || !age) {
                showNotification("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©", "error");
                return;
            }
            
            const submitBtn = document.querySelector('#calculatorForm button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...';
            submitBtn.disabled = true;
            
            try {
                // First, do manual calculation for immediate feedback
                const manualResult = manualCalculation(weight, height, age, gender, goal, planType, parseInt(workoutDays));
                
                // Then try AI calculation
                try {
                    const aiData = await getAIResults(weight, height, age, gender, goal, workoutDays, planType);
                    
                    userData = {
                        weight: weight,
                        height: height,
                        age: age,
                        gender: gender,
                        goal: goal,
                        workoutSystem: workoutSystem,
                        workoutDays: workoutDays,
                        planType: planType,
                        calories: parseInt(aiData.calories) || manualResult.calories,
                        protein: parseInt(aiData.protein) || manualResult.protein,
                        carbs: parseInt(aiData.carbs) || manualResult.carbs,
                        fat: parseInt(aiData.fat) || manualResult.fat,
                        tdee: parseInt(aiData.tdee) || manualResult.tdee,
                        bmr: parseInt(aiData.bmr) || manualResult.bmr,
                        recommendations: aiData.recommendations || manualResult.recommendations
                    };
                    
                    showNotification("âœ… ØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", "success");
                } catch (aiError) {
                    console.log("AI failed, using manual calculation:", aiError);
                    userData = manualResult;
                    showNotification("âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ (Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ØºÙŠØ± Ù…ØªÙˆÙØ±)", "info");
                }

                // Display results
                displayNutritionResults(userData);
                
                // Save to Firestore if user is logged in
                if (currentUser) {
                    try {
                        await window.firebaseSetDoc(
                            window.firebaseDoc(window.firebaseDb, "userCalculations", currentUser.uid),
                            {
                                ...userData,
                                timestamp: new Date().toISOString()
                            }
                        );
                    } catch (firestoreError) {
                        console.error("Firestore save error:", firestoreError);
                    }
                }
                
                // Switch to meal plan page
                setTimeout(() => {
                    switchPage('meal-plan');
                }, 500);
                
            } catch (error) {
                console.error("Calculation error:", error);
                showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨", "error");
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function getAIResults(weight, height, age, gender, goal, workoutDays, planType) {
            const activityLevel = calculateActivityLevel(parseInt(workoutDays));
            const genderText = gender === 'male' ? 'Ø°ÙƒØ±' : 'Ø£Ù†Ø«Ù‰';
            const goalText = getGoalText(goal);
            const planTypeText = planType === 'ramadan' ? 'Ø±Ù…Ø¶Ø§Ù†' : 'Ø¹Ø§Ø¯ÙŠ';
            
            const prompt = `Ù…Ø³ØªØ®Ø¯Ù… Ø¨ÙŠØ§Ù†Ø§ØªÙ‡:
Ø§Ù„ÙˆØ²Ù†: ${weight} ÙƒØ¬Ù…
Ø§Ù„Ø·ÙˆÙ„: ${height} Ø³Ù…
Ø§Ù„Ø¹Ù…Ø±: ${age} Ø³Ù†Ø©
Ø§Ù„Ø¬Ù†Ø³: ${genderText}
Ø§Ù„Ù‡Ø¯Ù: ${goalText}
Ø£ÙŠØ§Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹: ${workoutDays} Ø£ÙŠØ§Ù…
Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø©: ${planTypeText}

Ø£Ø±ÙŠØ¯:
1. Ø­Ø³Ø§Ø¨ BMR (Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£ÙŠØ¶ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
2. Ø­Ø³Ø§Ø¨ TDEE (Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ù†Ø´Ø§Ø·: ${activityLevel})
3. Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù‡Ø¯Ù
4. ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø§ÙƒØ±ÙˆØ² (Ø¨Ø±ÙˆØªÙŠÙ†ØŒ ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§ØªØŒ Ø¯Ù‡ÙˆÙ†) Ø¨Ø§Ù„Ø¬Ø±Ø§Ù…Ø§Øª

Ø£Ø¹Ø·Ù†ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ JSON ÙÙ‚Ø·:
{
    "calories": Ø§Ù„Ø±Ù‚Ù…,
    "protein": Ø§Ù„Ø±Ù‚Ù…,
    "carbs": Ø§Ù„Ø±Ù‚Ù…,
    "fat": Ø§Ù„Ø±Ù‚Ù…,
    "tdee": Ø§Ù„Ø±Ù‚Ù…,
    "bmr": Ø§Ù„Ø±Ù‚Ù…,
    "recommendations": "Ù†ØµÙŠØ­Ø© Ù…Ø®ØªØµØ±Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"
}`;

            const response = await callDeepSeekAPI(prompt);
            
            // Try to parse JSON response
            try {
                const jsonMatch = response.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
                return JSON.parse(response);
            } catch (e) {
                // If not valid JSON, extract numbers from text
                const numbers = response.match(/\d+/g);
                if (numbers && numbers.length >= 6) {
                    return {
                        calories: parseInt(numbers[0]),
                        protein: parseInt(numbers[1]),
                        carbs: parseInt(numbers[2]),
                        fat: parseInt(numbers[3]),
                        tdee: parseInt(numbers[4]),
                        bmr: parseInt(numbers[5]),
                        recommendations: "Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø±Ø­Ù„ØªÙƒ Ø§Ù„ØµØ­ÙŠØ©"
                    };
                }
                throw new Error("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù„ÙŠÙ„ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ");
            }
        }

        function calculateActivityLevel(workoutDays) {
            switch(workoutDays) {
                case 3: return 1.375;
                case 4: return 1.55;
                case 5: return 1.725;
                case 6: return 1.9;
                default: return 1.375;
            }
        }

        function manualCalculation(weight, height, age, gender, goal, planType, workoutDays) {
            const activityLevel = calculateActivityLevel(workoutDays);
            
            let bmr;
            if (gender === "male") {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            } else {
                bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
            }
            
            let tdee = Math.round(bmr * activityLevel);
            let calorieTarget, proteinMultiplier;
            
            switch(goal) {
                case "cutting":
                    calorieTarget = tdee * 0.85;
                    proteinMultiplier = 2.2;
                    break;
                case "bulking":
                    calorieTarget = tdee * 1.15;
                    proteinMultiplier = 1.8;
                    break;
                default:
                    calorieTarget = tdee;
                    proteinMultiplier = 1.6;
            }
            
            if (planType === "ramadan") {
                calorieTarget *= 0.9;
            }
            
            const proteinGrams = Math.round(weight * proteinMultiplier);
            const fatGrams = Math.round((calorieTarget * 0.25) / 9);
            const carbGrams = Math.round((calorieTarget - (proteinGrams * 4) - (fatGrams * 9)) / 4);
            
            return {
                calories: Math.round(calorieTarget),
                protein: proteinGrams,
                carbs: carbGrams,
                fat: fatGrams,
                tdee: tdee,
                bmr: Math.round(bmr),
                recommendations: `ØªÙ†Ø§ÙˆÙ„ ${Math.round(calorieTarget)} Ø³Ø¹Ø±Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹ØŒ Ù…Ø¹ ${proteinGrams}Øº Ø¨Ø±ÙˆØªÙŠÙ†ØŒ ${carbGrams}Øº ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§ØªØŒ ${fatGrams}Øº Ø¯Ù‡ÙˆÙ†. Ù…Ø§Ø±Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ù… ÙˆØ§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ Ø¨ÙƒØ«Ø±Ø©.`
            };
        }

        async function generateMealPlanWithAI() {
            if (!userData) return;
            
            const mealPlanContent = document.getElementById("mealPlanContent");
            const planTypeDisplay = document.getElementById("planTypeDisplay");
            const goalDisplay = document.getElementById("goalDisplay");
            
            // Show loading
            mealPlanContent.innerHTML = `
                <div class="text-center py-12">
                    <div class="loading mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                    <p class="text-gray-600 text-lg">ğŸ¤– Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...</p>
                </div>
            `;
            
            // Update displays
            if (planTypeDisplay) {
                planTypeDisplay.textContent = userData.planType === "ramadan" ? "Ø±Ù…Ø¶Ø§Ù†" : "Ø¹Ø§Ø¯ÙŠ";
            }
            if (goalDisplay) {
                goalDisplay.textContent = userData.goal === "cutting" ? "ØªÙ†Ø´ÙŠÙ" : userData.goal === "bulking" ? "ØªØ¶Ø®ÙŠÙ…" : "Ù…Ø­Ø§ÙØ¸Ø©";
            }
            
            // Update week display
            updateWeekDisplay();
            
            try {
                const days = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];
                const isRamadan = userData.planType === "ramadan";
                
                let weeklyPlan = "";
                
                for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
                    const dayPrompt = isRamadan ? 
                        `Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© ÙˆØ¬Ø¨Ø§Øª Ù„ÙŠÙˆÙ… ${days[dayIndex]} ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:
                         Ø§Ù„Ù‡Ø¯Ù: ${getGoalText(userData.goal)}
                         Ø§Ù„Ø³Ø¹Ø±Ø§Øª: ${userData.calories}
                         Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†: ${userData.protein}Øº
                         Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª: ${userData.carbs}Øº
                         Ø§Ù„Ø¯Ù‡ÙˆÙ†: ${userData.fat}Øº
                         
                         Ø£Ø±ÙŠØ¯:
                         1. ÙˆØ¬Ø¨Ø© Ø¥ÙØ·Ø§Ø± (Ø¨Ø¹Ø¯ Ø§Ù„Ù…ØºØ±Ø¨)
                         2. ÙˆØ¬Ø¨Ø© Ø³Ø­ÙˆØ±
                         3. ÙˆØ¬Ø¨ØªÙŠÙ† Ø®ÙÙŠÙØªÙŠÙ† Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙˆØ§Ù„Ø³Ø­ÙˆØ±
                         4. Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØºØ°Ø§Ø¦ÙŠ Ù„ÙƒÙ„ ÙˆØ¬Ø¨Ø©` :
                         
                        `Ø£Ù†Ø´Ø¦ Ø®Ø·Ø© ÙˆØ¬Ø¨Ø§Øª Ù„ÙŠÙˆÙ… ${days[dayIndex]}:
                         Ø§Ù„Ù‡Ø¯Ù: ${getGoalText(userData.goal)}
                         Ø§Ù„Ø³Ø¹Ø±Ø§Øª: ${userData.calories}
                         Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†: ${userData.protein}Øº
                         Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª: ${userData.carbs}Øº
                         Ø§Ù„Ø¯Ù‡ÙˆÙ†: ${userData.fat}Øº
                         
                         Ø£Ø±ÙŠØ¯:
                         1. ÙˆØ¬Ø¨Ø© ÙØ·ÙˆØ±
                         2. ÙˆØ¬Ø¨Ø© ØºØ¯Ø§Ø¡
                         3. ÙˆØ¬Ø¨Ø© Ø¹Ø´Ø§Ø¡
                         4. ÙˆØ¬Ø¨ØªÙŠÙ† Ø®ÙÙŠÙØªÙŠÙ†
                         5. Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØºØ°Ø§Ø¦ÙŠ Ù„ÙƒÙ„ ÙˆØ¬Ø¨Ø©`;
                    
                    try {
                        const dayPlan = await callDeepSeekAPI(dayPrompt);
                        weeklyPlan += `
                            <div class="bg-gray-50 rounded-2xl p-6 mb-6">
                                <h4 class="text-xl font-bold text-dark mb-4 pb-3 border-b border-gray-200">${days[dayIndex]} - Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${currentWeek}</h4>
                                <div class="prose prose-lg max-w-none">
                                    ${formatAIResponse(dayPlan)}
                                </div>
                            </div>
                        `;
                    } catch (error) {
                        weeklyPlan += `
                            <div class="bg-gray-50 rounded-2xl p-6 mb-6">
                                <h4 class="text-xl font-bold text-dark mb-4 pb-3 border-b border-gray-200">${days[dayIndex]} - Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${currentWeek}</h4>
                                <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                                    <p class="text-yellow-800">âš ï¸ ØªØ¹Ø°Ø± ØªÙˆÙ„ÙŠØ¯ Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
                                    <p class="text-gray-600 mt-2">Ø§Ø³ØªØ®Ø¯Ù… Ø®Ø·Ø© Ø¨Ø¯ÙŠÙ„Ø©:</p>
                                    ${generateBackupMealPlan(dayIndex, isRamadan)}
                                </div>
                            </div>
                        `;
                    }
                }
                
                mealPlanContent.innerHTML = `
                    <div class="space-y-6">
                        ${weeklyPlan}
                        <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6">
                            <h4 class="font-bold text-dark mb-4">ğŸ“ Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${currentWeek}:</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-bold text-gray-800 mb-3">ğŸ¥¦ Ù†ØµØ§Ø¦Ø­ ØºØ°Ø§Ø¦ÙŠØ©:</h5>
                                    <ul class="space-y-2 text-gray-700">
                                        <li>â€¢ Ø§Ø´Ø±Ø¨ 3-4 Ù„ØªØ± Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹</li>
                                        <li>â€¢ ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø®Ø¶Ø±ÙˆØ§Øª Ù…Ø¹ ÙƒÙ„ ÙˆØ¬Ø¨Ø©</li>
                                        <li>â€¢ ØªØ¬Ù†Ø¨ Ø§Ù„Ø³ÙƒØ±ÙŠØ§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</li>
                                        <li>â€¢ ØªÙ†Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ù…Ø¹ ÙƒÙ„ ÙˆØ¬Ø¨Ø©</li>
                                        ${isRamadan ? '<li>â€¢ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ Ø¨ÙŠÙ† Ø§Ù„Ø¥ÙØ·Ø§Ø± ÙˆØ§Ù„Ø³Ø­ÙˆØ±</li>' : ''}
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-bold text-gray-800 mb-3">ğŸ¯ Ø­Ø³Ø¨ Ù‡Ø¯ÙÙƒ:</h5>
                                    <ul class="space-y-2 text-gray-700">
                                        ${userData.goal === 'cutting' ? 
                                            '<li>â€¢ Ù‚Ù„Ù„ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¡</li><li>â€¢ Ø§Ù…Ø´ 30 Ø¯Ù‚ÙŠÙ‚Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹</li><li>â€¢ Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†</li>' :
                                          userData.goal === 'bulking' ?
                                            '<li>â€¢ Ø²Ø¯ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</li><li>â€¢ ØªÙ†Ø§ÙˆÙ„ ÙˆØ¬Ø¨Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…</li><li>â€¢ Ø±ÙƒØ² Ø¹Ù„Ù‰ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù‚ÙˆØ©</li>' :
                                            '<li>â€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ ØªÙˆØ§Ø²Ù† Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</li><li>â€¢ Ù…Ø§Ø±Ø³ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ù…</li><li>â€¢ ØªØ§Ø¨Ø¹ ÙˆØ²Ù†Ùƒ Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</li>'
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error("Meal plan generation error:", error);
                mealPlanContent.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ˜•</div>
                        <p class="text-gray-600 text-lg">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø·Ø© Ø§Ù„ØªØºØ°ÙŠØ©</p>
                        <p class="text-gray-400 text-sm mb-4">${error.message || "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"}</p>
                        <button onclick="generateMealPlanWithAI()" class="mt-4 gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200">
                            <i class="fas fa-redo ml-2"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                        </button>
                    </div>
                `;
            }
        }

        function generateBackupMealPlan(dayIndex, isRamadan) {
            const meals = {
                breakfast: ["Ø´ÙˆÙØ§Ù† Ù…Ø¹ Ø­Ù„ÙŠØ¨ ÙˆÙ…ÙˆØ²", "Ø¹Ø¬Ø© Ø¨ÙŠØ¶ Ù…Ø¹ Ø®Ø¶Ø§Ø±", "Ø³Ù…ÙˆØ°ÙŠ Ø¨Ø±ÙˆØªÙŠÙ† Ø¨Ø§Ù„ØªÙ…Ø±", "Ø®Ø¨Ø² ØªÙˆØ³Øª Ù…Ø¹ Ø£ÙÙˆÙƒØ§Ø¯Ùˆ", "Ù„Ø¨Ù† ÙŠÙˆÙ†Ø§Ù†ÙŠ Ù…Ø¹ ØªÙˆØª", "ÙÙˆÙ„ Ù…Ø¯Ù…Ø³ Ù…Ø¹ Ø²ÙŠØª Ø²ÙŠØªÙˆÙ†", "Ø¨Ø§Ù† ÙƒÙŠÙƒ Ø¨Ø±ÙˆØªÙŠÙ†"],
                lunch: ["ØµØ¯Ø± Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠ Ù…Ø¹ Ø£Ø±Ø² Ø¨Ù†ÙŠ", "Ø³Ù…Ùƒ Ø³Ù„Ù…ÙˆÙ† Ù…Ø¹ Ø¨Ø·Ø§Ø·Ø§ Ø­Ù„ÙˆØ©", "Ù„Ø­Ù… Ø¨Ù‚Ø±ÙŠ Ù…Ø¹ Ø®Ø¶Ø§Ø± Ø³ÙˆØªÙŠÙ‡", "Ø¨Ø±Ø¬Ø± Ø¯Ø¬Ø§Ø¬ Ù…Ø¹ Ø³Ù„Ø·Ø©", "Ù…Ø¹ÙƒØ±ÙˆÙ†Ø© Ù…Ø¹ Ø¯Ø¬Ø§Ø¬ Ùˆ ØµÙ„ØµØ©", "ÙƒÙˆØ³Ø© Ù…Ø­Ø´ÙŠØ© Ø¨Ø§Ù„Ù„Ø­Ù…", "Ø´ÙˆØ±Ø¨Ø© Ø¹Ø¯Ø³ Ù…Ø¹ Ø®Ø¨Ø²"],
                dinner: ["Ø³Ù„Ø·Ø© ØªÙˆÙ†Ø© Ù…Ø¹ Ø®Ø¶Ø§Ø±", "Ø£ÙˆÙ…Ù„ÙŠØª Ø¨ÙŠØ¶ Ù…Ø¹ Ø¬Ø¨Ù†", "Ø³Ù„Ù…ÙˆÙ† Ù…Ø¹ Ø¨Ø±ÙˆÙƒÙ„ÙŠ", "Ø´ÙˆØ±Ø¨Ø© Ø®Ø¶Ø§Ø± Ù…Ø¹ Ø¯Ø¬Ø§Ø¬", "Ø²Ø¨Ø§Ø¯ÙŠ ÙŠÙˆÙ†Ø§Ù†ÙŠ Ù…Ø¹ Ù…ÙƒØ³Ø±Ø§Øª", "Ø³Ù†Ø¯ÙˆÙŠØ´ ØªÙˆÙ†Ø© Ù…Ø¹ Ø®Ø³", "Ø¨ÙŠØ¶ Ù…Ø³Ù„ÙˆÙ‚ Ù…Ø¹ Ø£ÙÙˆÙƒØ§Ø¯Ùˆ"],
                snacks: ["ØªÙØ§Ø­Ø© Ù…Ø¹ Ø²Ø¨Ø¯Ø© ÙÙˆÙ„ Ø³ÙˆØ¯Ø§Ù†ÙŠ", "Ù…ÙƒØ³Ø±Ø§Øª Ù…Ø´ÙƒÙ„Ø©", "Ø¨Ø±ÙˆØªÙŠÙ† Ø´ÙŠÙƒ", "Ø¬Ø¨Ù†Ø© Ù‚Ø±ÙŠØ´", "Ø­Ø¨Ø§Øª ØªÙ…Ø±", "Ø®ÙŠØ§Ø± ÙˆØ¬Ø²Ø±", "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ© Ø¯Ø§ÙƒÙ†Ø©"]
            };
            
            if (isRamadan) {
                return `
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg">
                            <h6 class="font-bold text-green-700 mb-2">ğŸ½ï¸ Ø§Ù„Ø¥ÙØ·Ø§Ø±:</h6>
                            <p>${meals.lunch[dayIndex]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.4)} Ø³Ø¹Ø±Ø©</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg">
                            <h6 class="font-bold text-blue-700 mb-2">ğŸŒ™ Ø³Ø­ÙˆØ±:</h6>
                            <p>${meals.dinner[dayIndex]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.3)} Ø³Ø¹Ø±Ø©</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg">
                            <h6 class="font-bold text-yellow-700 mb-2">ğŸ¥› ÙˆØ¬Ø¨ØªÙŠÙ† Ø®ÙÙŠÙØªÙŠÙ†:</h6>
                            <p>${meals.snacks[dayIndex]} + ${meals.breakfast[dayIndex]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.3)} Ø³Ø¹Ø±Ø©</p>
                        </div>
                    </div>
                `;
            } else {
                return `
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg">
                            <h6 class="font-bold text-green-700 mb-2">ğŸŒ… Ø§Ù„ÙØ·ÙˆØ±:</h6>
                            <p>${meals.breakfast[dayIndex]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.25)} Ø³Ø¹Ø±Ø©</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg">
                            <h6 class="font-bold text-blue-700 mb-2">â˜€ï¸ Ø§Ù„ØºØ¯Ø§Ø¡:</h6>
                            <p>${meals.lunch[dayIndex]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.35)} Ø³Ø¹Ø±Ø©</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg">
                            <h6 class="font-bold text-purple-700 mb-2">ğŸŒ™ Ø§Ù„Ø¹Ø´Ø§Ø¡:</h6>
                            <p>${meals.dinner[dayIndex]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.25)} Ø³Ø¹Ø±Ø©</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg">
                            <h6 class="font-bold text-yellow-700 mb-2">ğŸ¥› ÙˆØ¬Ø¨Ø§Øª Ø®ÙÙŠÙØ©:</h6>
                            <p>${meals.snacks[dayIndex]}</p>
                            <p class="text-sm text-gray-500 mt-1">${Math.round(userData.calories * 0.15)} Ø³Ø¹Ø±Ø©</p>
                        </div>
                    </div>
                `;
            }
        }

        async function generateWorkoutPlanWithAI() {
            if (!userData) return;
            
            const workoutPlanContent = document.getElementById("workoutPlanContent");
            const workoutSystemDisplay = document.getElementById("workoutSystemDisplay");
            const workoutDaysDisplay = document.getElementById("workoutDaysDisplay");
            const workoutGoalDisplay = document.getElementById("workoutGoalDisplay");
            
            // Update displays
            if (workoutSystemDisplay) {
                workoutSystemDisplay.textContent = getWorkoutSystemText(userData.workoutSystem);
            }
            if (workoutDaysDisplay) {
                workoutDaysDisplay.textContent = userData.workoutDays;
            }
            if (workoutGoalDisplay) {
                workoutGoalDisplay.textContent = getGoalText(userData.goal);
            }
            
            // Show loading
            workoutPlanContent.innerHTML = `
                <div class="text-center py-12">
                    <div class="loading mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                    <p class="text-gray-600 text-lg">ğŸ¤– Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...</p>
                </div>
            `;
            
            try {
                const prompt = `Ø£Ù†Ø´Ø¦ Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ…Ø§Ø±ÙŠÙ† ${getWorkoutSystemText(userData.workoutSystem)} Ù„Ù€ ${userData.workoutDays} Ø£ÙŠØ§Ù… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹.
Ø§Ù„Ù‡Ø¯Ù: ${getGoalText(userData.goal)}
Ø§Ù„ÙˆØ²Ù†: ${userData.weight} ÙƒØ¬Ù…
Ø§Ù„Ø¹Ù…Ø±: ${userData.age} Ø³Ù†Ø©
Ø§Ù„Ø¬Ù†Ø³: ${userData.gender === 'male' ? 'Ø°ÙƒØ±' : 'Ø£Ù†Ø«Ù‰'}

Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:
1. Ø¬Ø¯ÙˆÙ„ Ø£Ø³Ø¨ÙˆØ¹ÙŠ ÙƒØ§Ù…Ù„
2. Ù„ÙƒÙ„ ÙŠÙˆÙ…: Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†ØŒ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŒ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§ØªØŒ Ø§Ù„Ø±Ø§Ø­Ø©
3. Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ù„Ù„ØªÙƒÙ†ÙŠÙƒ Ø§Ù„ØµØ­ÙŠØ­
4. Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø§Ø³ØªØ´ÙØ§Ø¡
5. ØªÙ…Ø§Ø±ÙŠÙ† Ø¥Ø­Ù…Ø§Ø¡ ÙˆØªÙ‡Ø¯Ø¦Ø©
6. ${userData.goal === 'cutting' ? 'Ø£Ø¶Ù ØªÙ…Ø§Ø±ÙŠÙ† ÙƒØ§Ø±Ø¯ÙŠÙˆ' : 'Ø±ÙƒØ² Ø¹Ù„Ù‰ ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù‚ÙˆØ©'}
7. Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©

Ù‚Ø¯Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨ØªÙ†Ø³ÙŠÙ‚ HTML Ù…Ù†Ø¸Ù… ÙˆØ¬Ù…ÙŠØ¹.`;

                const response = await callDeepSeekAPI(prompt);
                
                // Display the workout plan
                workoutPlanContent.innerHTML = `
                    <div class="space-y-8">
                        <div class="prose prose-lg max-w-none">
                            ${formatAIResponse(response)}
                        </div>
                        <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6">
                            <h4 class="font-bold text-dark mb-4">ğŸ’¡ Ù†ØµØ§Ø¦Ø­ Ø¥Ø¶Ø§ÙÙŠØ©:</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-bold text-gray-800 mb-3">ğŸ‹ï¸â€â™‚ï¸ Ù†ØµØ§Ø¦Ø­ Ø§Ù„ØªÙ…Ø±ÙŠÙ†:</h5>
                                    <ul class="space-y-2 text-gray-700">
                                        <li>â€¢ Ø¥Ø­Ù…Ø§Ø¡ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù‚Ø¨Ù„ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</li>
                                        <li>â€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„ØªÙ…Ø§Ø±ÙŠÙ†</li>
                                        <li>â€¢ Ø²Ø¯ Ø§Ù„Ø£ÙˆØ²Ø§Ù† ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹</li>
                                        <li>â€¢ Ø§Ø³ØªØ±Ø­ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª 60-90 Ø«Ø§Ù†ÙŠØ©</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-bold text-gray-800 mb-3">ğŸ Ù†ØµØ§Ø¦Ø­ ØºØ°Ø§Ø¦ÙŠØ© Ù„Ù„ØªÙ…Ø±ÙŠÙ†:</h5>
                                    <ul class="space-y-2 text-gray-700">
                                        <li>â€¢ ØªÙ†Ø§ÙˆÙ„ ÙˆØ¬Ø¨Ø© Ø¨Ø±ÙˆØªÙŠÙ† Ù‚Ø¨Ù„ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¨Ø³Ø§Ø¹Ø©</li>
                                        <li>â€¢ Ø§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ Ø£Ø«Ù†Ø§Ø¡ ÙˆØ¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</li>
                                        <li>â€¢ ØªÙ†Ø§ÙˆÙ„ ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</li>
                                        <li>â€¢ Ù†Ø§Ù… 7-8 Ø³Ø§Ø¹Ø§Øª Ù„Ù„Ø§Ø³ØªØ´ÙØ§Ø¡</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error("Workout plan generation error:", error);
                workoutPlanContent.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ˜•</div>
                        <p class="text-gray-600 text-lg">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†</p>
                        <p class="text-gray-400 text-sm mb-4">${error.message || "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰"}</p>
                        <button onclick="generateWorkoutPlanWithAI()" class="mt-4 gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200">
                            <i class="fas fa-redo ml-2"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                        </button>
                    </div>
                `;
            }
        }

        async function callDeepSeekAPI(prompt) {
            try {
                console.log("Sending request to DeepSeek API...");
                
                const response = await fetch(DEEPSEEK_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {
                                role: "system",
                                content: "Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ù„ÙŠØ§Ù‚Ø© Ø¨Ø¯Ù†ÙŠØ© ÙˆØªØºØ°ÙŠØ©. Ù‚Ø¯Ù… Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ÙØµÙ„Ø© ÙˆØ¹Ù…Ù„ÙŠØ© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø³Ù„ÙˆØ¨Ù‹Ø§ ÙˆØ§Ø¶Ø­Ù‹Ø§ ÙˆØ³Ù‡Ù„ Ø§Ù„ÙÙ‡Ù…."
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                console.log("Response status:", response.status);
                
                if (!response.ok) {
                    throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ: ${response.status}`);
                }

                const data = await response.json();
                console.log("API Response received");
                
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    throw new Error("Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ");
                }
                
                return data.choices[0].message.content;
                
            } catch (error) {
                console.error("API Call error:", error);
                throw error;
            }
        }

        function formatAIResponse(response) {
            // Format the AI response for better display
            let formatted = response
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<li>$1</li>')
                .replace(/# (.*?)(\n|$)/g, '<h3 class="text-xl font-bold mt-4 mb-2">$1</h3>')
                .replace(/## (.*?)(\n|$)/g, '<h4 class="text-lg font-bold mt-3 mb-2">$1</h4>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
            
            return `<div class="ai-response">${formatted}</div>`;
        }

        function getGoalText(goal) {
            const goals = {
                'cutting': 'ØªÙ†Ø´ÙŠÙ ÙˆØ­Ø±Ù‚ Ø§Ù„Ø¯Ù‡ÙˆÙ†',
                'bulking': 'ØªØ¶Ø®ÙŠÙ… ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª',
                'maintain': 'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†'
            };
            return goals[goal] || goal;
        }

        function getWorkoutSystemText(system) {
            const systems = {
                'bro_split': 'Ø¨Ø±Ùˆ Ø³Ø¨Ù„Øª (Ø¹Ø¶Ù„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„ÙŠÙˆÙ…)',
                'push_pull_legs': 'Ø¨ÙˆØ´ Ø¨ÙˆÙ„ Ù„ÙŠØ¬ (Ø¯ÙØ¹-Ø³Ø­Ø¨-Ø£Ø±Ø¬Ù„)',
                'arnold_split': 'Ø£Ø±Ù†ÙˆÙ„Ø¯ Ø³Ø¨Ù„Øª',
                'full_body': 'ØªÙ…Ø§Ø±ÙŠÙ† ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ø¬Ø³Ù…'
            };
            return systems[system] || system;
        }

        function displayNutritionResults(data) {
            const resultsDiv = document.getElementById("results");
            if (!resultsDiv) return;
            
            const goalText = getGoalText(data.goal);
            const planTypeText = data.planType === "ramadan" ? "Ø±Ù…Ø¶Ø§Ù†" : "Ø¹Ø§Ø¯ÙŠ";
            const workoutSystemText = getWorkoutSystemText(data.workoutSystem);
            
            const resultsHTML = `
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-xl text-center meal-card">
                        <div class="text-2xl font-bold text-primary mb-2">${data.calories}</div>
                        <div class="text-gray-600">Ø³Ø¹Ø±Ø© Ø­Ø±Ø§Ø±ÙŠØ©</div>
                        <div class="text-sm text-gray-500 mt-1">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-xl text-center meal-card">
                        <div class="text-2xl font-bold text-secondary mb-2">${data.protein} Øº</div>
                        <div class="text-gray-600">Ø¨Ø±ÙˆØªÙŠÙ†</div>
                        <div class="text-sm text-gray-500 mt-1">${data.protein * 4} Ø³Ø¹Ø±Ø©</div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-xl text-center meal-card">
                        <div class="text-2xl font-bold text-yellow-600 mb-2">${data.carbs} Øº</div>
                        <div class="text-gray-600">ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª</div>
                        <div class="text-sm text-gray-500 mt-1">${data.carbs * 4} Ø³Ø¹Ø±Ø©</div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-xl text-center meal-card">
                        <div class="text-2xl font-bold text-purple-600 mb-2">${data.fat} Øº</div>
                        <div class="text-gray-600">Ø¯Ù‡ÙˆÙ†</div>
                        <div class="text-sm text-gray-500 mt-1">${data.fat * 9} Ø³Ø¹Ø±Ø©</div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-xl text-center meal-card">
                        <div class="text-2xl font-bold text-gray-700 mb-2">${data.tdee}</div>
                        <div class="text-gray-600">TDEE</div>
                        <div class="text-sm text-gray-500 mt-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ù†ÙØ§Ù‚</div>
                    </div>
                    
                    <div class="bg-red-50 p-4 rounded-xl text-center meal-card">
                        <div class="text-2xl font-bold text-red-600 mb-2">${data.bmr}</div>
                        <div class="text-gray-600">BMR</div>
                        <div class="text-sm text-gray-500 mt-1">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£ÙŠØ¶ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl p-6 mb-6">
                    <div class="flex items-center mb-4">
                        <i class="fas fa-robot text-primary text-xl ml-2"></i>
                        <h4 class="font-bold text-dark">ğŸ¤– ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:</h4>
                    </div>
                    <p class="text-gray-700 mb-4">${data.recommendations}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-primary rounded-full ml-2"></div>
                            <span>Ø§Ù„Ù‡Ø¯Ù: <span class="font-bold">${goalText}</span></span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-secondary rounded-full ml-2"></div>
                            <span>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·Ø©: <span class="font-bold">${planTypeText}</span></span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-accent rounded-full ml-2"></div>
                            <span>Ø£ÙŠØ§Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ†: <span class="font-bold">${data.workoutDays} ÙŠÙˆÙ… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</span></span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-2 h-2 bg-purple-500 rounded-full ml-2"></div>
                            <span>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†: <span class="font-bold">${workoutSystemText}</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="text-center pt-6">
                    <button onclick="switchPage('meal-plan')" class="gradient-bg hover:opacity-90 text-white font-bold py-3 px-8 rounded-xl transition-all duration-200 transform hover:scale-[1.02] shadow-lg">
                        <i class="fas fa-utensils ml-2"></i> Ø´Ø§Ù‡Ø¯ Ø®Ø·Ø© Ø§Ù„ØªØºØ°ÙŠØ©
                    </button>
                </div>
            `;
            
            resultsDiv.innerHTML = resultsHTML;
        }

        function switchPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('nav-active');
            });
            
            // Show selected page
            const pageElement = document.getElementById(pageName + '-page');
            if (pageElement) {
                pageElement.classList.add('active');
                
                // Add active class to selected nav item
                const navItem = document.querySelector(`.nav-item[data-page="${pageName}"]`);
                if (navItem) {
                    navItem.classList.add('nav-active');
                }
                
                // Update content if user data exists
                if (userData) {
                    if (pageName === 'meal-plan') {
                        generateMealPlanWithAI();
                    } else if (pageName === 'workout') {
                        generateWorkoutPlanWithAI();
                    }
                }
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updateWeekDisplay() {
            const weekDisplay = document.getElementById("weekDisplay");
            if (weekDisplay) {
                weekDisplay.textContent = `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${currentWeek}`;
                
                // Update button states
                const prevWeekBtn = document.getElementById("prevWeek");
                const nextWeekBtn = document.getElementById("nextWeek");
                
                if (prevWeekBtn) {
                    prevWeekBtn.disabled = currentWeek === 1;
                    prevWeekBtn.classList.toggle("opacity-50", currentWeek === 1);
                    prevWeekBtn.classList.toggle("cursor-not-allowed", currentWeek === 1);
                }
                
                if (nextWeekBtn) {
                    nextWeekBtn.disabled = currentWeek === 4;
                    nextWeekBtn.classList.toggle("opacity-50", currentWeek === 4);
                    nextWeekBtn.classList.toggle("cursor-not-allowed", currentWeek === 4);
                }
            }
        }

        function showNotification(message, type = "info") {
            // Remove any existing notifications
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            // Create notification element
            const notification = document.createElement("div");
            notification.className = `notification fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg text-white font-bold transform transition-all duration-300 ${
                type === "success" ? "bg-gradient-to-r from-green-500 to-green-600" :
                type === "error" ? "bg-gradient-to-r from-red-500 to-red-600" :
                "bg-gradient-to-r from-blue-500 to-blue-600"
            }`;
            notification.textContent = message;
            
            // Add to body
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = "0";
                notification.style.transform = "translateX(100%)";
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Make functions global
        window.switchPage = switchPage;
        window.generateWorkoutPlanWithAI = generateWorkoutPlanWithAI;
        window.generateMealPlanWithAI = generateMealPlanWithAI;
    </script>
</body>
</html>

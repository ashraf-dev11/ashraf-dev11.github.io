<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness AI Planner</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<div id="authSection" class="flex items-center justify-center h-screen">
    <div class="bg-white p-8 rounded-xl shadow-md text-center">
        <h2 class="text-2xl font-bold mb-6">تسجيل الدخول</h2>
        <button id="googleLogin" class="bg-red-500 text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition">تسجيل دخول بجوجل</button>
    </div>
</div>

<div id="mainApp" class="hidden p-6 max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">خطةك الشهرية الذكية</h1>
    
    <!-- بيانات المستخدم -->
    <div id="userForm" class="bg-white p-6 rounded-xl shadow-md mb-6">
        <h2 class="text-xl font-bold mb-4">أدخل بياناتك</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="number" id="age" placeholder="العمر" class="p-3 border rounded w-full">
            <input type="number" id="weight" placeholder="الوزن (كجم)" class="p-3 border rounded w-full">
            <input type="number" id="height" placeholder="الطول (سم)" class="p-3 border rounded w-full">
            <select id="goal" class="p-3 border rounded w-full">
                <option value="">اختر هدفك</option>
                <option value="cutting">تنشيف</option>
                <option value="bulking">تضخيم</option>
                <option value="maintenance">محافظة</option>
            </select>
        </div>
        <button id="generatePlan" class="mt-6 bg-blue-500 text-white px-6 py-3 rounded-xl font-bold hover:opacity-90 transition w-full">انشئ خطتك</button>
    </div>

    <!-- خطة الطعام -->
    <div id="mealPlan" class="space-y-6"></div>

    <!-- خطة التمرين -->
    <div id="workoutPlan" class="space-y-6 mt-8"></div>
</div>

<script>
    // Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyA7POxxSjiEHElUMEoQ90TTlBs2WBEE18g",
        authDomain: "fittnes-web.firebaseapp.com",
        projectId: "fittnes-web",
        storageBucket: "fittnes-web.firebasestorage.app",
        messagingSenderId: "1043684216161",
        appId: "1:1043684216161:web:7ffa29e8c215bcc480c920",
        measurementId: "G-8BQBEPH5Z8"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const authSection = document.getElementById("authSection");
    const mainApp = document.getElementById("mainApp");
    const googleLogin = document.getElementById("googleLogin");

    // تسجيل دخول جوجل
    googleLogin.addEventListener("click", async () => {
        const provider = new firebase.auth.GoogleAuthProvider();
        try {
            await auth.signInWithPopup(provider);
        } catch (error) {
            alert("حدث خطأ أثناء تسجيل الدخول: " + error.message);
        }
    });

    auth.onAuthStateChanged(user => {
        if (user) {
            authSection.classList.add("hidden");
            mainApp.classList.remove("hidden");
        } else {
            authSection.classList.remove("hidden");
            mainApp.classList.add("hidden");
        }
    });

    const generatePlanBtn = document.getElementById("generatePlan");
    generatePlanBtn.addEventListener("click", async () => {
        const age = document.getElementById("age").value;
        const weight = document.getElementById("weight").value;
        const height = document.getElementById("height").value;
        const goal = document.getElementById("goal").value;

        if(!age || !weight || !height || !goal){
            alert("من فضلك املأ كل البيانات");
            return;
        }

        const userData = { age, weight, height, goal };
        
        // عرض تحميل
        document.getElementById("mealPlan").innerHTML = `<p class="text-center py-12 text-gray-600">جاري إنشاء خطة الطعام...</p>`;
        document.getElementById("workoutPlan").innerHTML = `<p class="text-center py-12 text-gray-600">جاري إنشاء خطة التمرين...</p>`;

        try {
            // استدعاء API
            const response = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer sk-ab32e91009014e1fa3c0d43d0f2813bd"
                },
                body: JSON.stringify({
                    model: "gpt-4",
                    messages: [
                        {role:"system", content:"انت مدرب ولياقه واطباء تغذيه."},
                        {role:"user", content: `
صمم خطة شهرية كاملة لشخص عمره ${age} سنة، وزنه ${weight} كجم، طوله ${height} سم، هدفه ${goal}.
قسم الخطة لأربع أسابيع.
لكل أسبوع أعطني:
- خطة الوجبات اليومية مع السعرات، البروتين، الكارب، الدهون.
- خطة التمرين اليومية لكل يوم، عدد المجموعات والتكرارات والراحة.
- عرض الخطة أسبوع بأسبوع بشكل مرتب بالHTML مناسب للعرض مباشرة.
` }
                    ],
                    max_tokens: 2000
                })
            });
            
            const data = await response.json();
            const aiContent = data.choices[0].message.content;

            // عرض المحتوى مباشرة
            document.getElementById("mealPlan").innerHTML = aiContent;
            document.getElementById("workoutPlan").innerHTML = "";
        } catch (error) {
            document.getElementById("mealPlan").innerHTML = `<p class="text-center py-12 text-red-500">حدث خطأ في إنشاء الخطة</p>`;
            console.error(error);
        }
    });
</script>

</body>
</html>
